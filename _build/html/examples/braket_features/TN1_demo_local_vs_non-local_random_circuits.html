<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>Testing the tensor network simulator with 2-local Hayden-Preskill circuits - Amazon Braket Examples documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Amazon Braket Examples  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">Amazon Braket Examples  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  
</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="testing-the-tensor-network-simulator-with-2-local-hayden-preskill-circuits">
<h1>Testing the tensor network simulator with 2-local Hayden-Preskill circuits<a class="headerlink" href="#testing-the-tensor-network-simulator-with-2-local-hayden-preskill-circuits" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use Braket SDK Cost Tracking to estimate the cost to run this example</span>
<span class="kn">from</span> <span class="nn">braket.tracking</span> <span class="kn">import</span> <span class="n">Tracker</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Tracker</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Abstract:</strong> We study a class of random quantum circuits known as Hayden-Preskill circuits using the tensor network simulator backend in Amazon Braket. The goal is to understand the degree to which the tensor network simulator is capable of detecting a hidden local structure in a quantum circuit, while simultaneously building experience with the Amazon Braket service and SDK. We find that the TN1 tensor network simulator can efficiently simulate local random quantum circuits, even when the local structure is obfuscated by permuting the qubit indices. Conversely, when running genuinely non-local versions of the quantum circuits, the simulator’s performance is significantly degraded.</p>
<p>This notebook is aimed at users who are familiar with Amazon Braket and have a working knowledge of quantum computing and quantum circuits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">braket.circuits</span> <span class="kn">import</span> <span class="n">Circuit</span>
<span class="kn">from</span> <span class="nn">braket.aws</span> <span class="kn">import</span> <span class="n">AwsDevice</span>
<span class="kn">from</span> <span class="nn">braket.devices</span> <span class="kn">import</span> <span class="n">LocalSimulator</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
</div>
<section id="setup-the-tensor-network-simulator">
<h2>Setup the tensor network simulator:<a class="headerlink" href="#setup-the-tensor-network-simulator" title="Permalink to this heading">#</a></h2>
<p>In this notebook we will use the TN1 simulator on Amazon Braket <span class="xref myst">[1]</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="n">AwsDevice</span><span class="p">(</span><span class="s2">&quot;arn:aws:braket:::device/quantum-simulator/amazon/tn1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="local-hayden-preskill-circuits">
<h2>Local Hayden-Preskill Circuits<a class="headerlink" href="#local-hayden-preskill-circuits" title="Permalink to this heading">#</a></h2>
<p>Hayden-Preskill circuits are a class of unstructured, random quantum circuits.  To produce a Hayden-Preskill circuit, one chooses a gate at random from some universal gate set at each time step and applies this gate to random target qubits.  For example, one can choose to either apply a random single qubit rotation to a random qubit, or a CZ gate to a random pair of qubits at each time step.  As a concrete example, consider the following pseudocode:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Choose</span> <span class="n">either</span> <span class="p">{</span><span class="n">single</span> <span class="n">qubit</span><span class="p">,</span> <span class="n">two</span> <span class="n">qubit</span><span class="p">}</span> <span class="n">gate</span> <span class="n">w</span><span class="o">/</span> <span class="n">prob</span><span class="o">.</span> <span class="p">{</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">}</span>
 
<span class="n">If</span> <span class="n">single</span> <span class="n">qubit</span><span class="p">:</span>
    <span class="n">Choose</span> <span class="n">either</span> <span class="p">{</span><span class="n">Rx</span><span class="p">,</span> <span class="n">Ry</span><span class="p">,</span> <span class="n">Rz</span><span class="p">,</span> <span class="n">H</span><span class="p">}</span> <span class="n">randomly</span> <span class="n">w</span><span class="o">/</span> <span class="n">prob</span><span class="o">.</span> <span class="p">{</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">}</span>    
    <span class="n">Apply</span> <span class="n">the</span> <span class="n">chosen</span> <span class="n">gate</span> <span class="n">to</span> <span class="n">a</span> <span class="n">randomly</span> <span class="n">chosen</span> <span class="n">qubit</span>
    <span class="n">If</span> <span class="n">the</span> <span class="n">gate</span> <span class="ow">is</span> <span class="n">Rx</span><span class="p">,</span> <span class="n">Ry</span><span class="p">,</span> <span class="ow">or</span> <span class="n">Rz</span><span class="p">,</span> <span class="n">rotate</span> <span class="n">by</span> <span class="n">a</span> <span class="n">randomly</span> <span class="n">chosen</span> <span class="n">angle</span>
 
<span class="n">If</span> <span class="n">two</span> <span class="n">qubit</span> <span class="n">gate</span><span class="p">:</span>
    <span class="n">Choose</span> <span class="p">(</span><span class="n">qubit</span> <span class="mi">1</span><span class="p">,</span> <span class="n">qubit</span> <span class="mi">2</span><span class="p">)</span> <span class="n">to</span> <span class="n">be</span> <span class="n">two</span> <span class="n">randomly</span> <span class="n">chosen</span> <span class="n">qubits</span> <span class="n">out</span> <span class="n">of</span> <span class="n">the</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">N</span> <span class="n">qubits</span>
    <span class="n">Apply</span> <span class="n">CZ</span><span class="p">(</span><span class="n">qubit</span> <span class="mi">1</span><span class="p">,</span> <span class="n">qubit</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># This means the couplings are long range, all-to-all</span>
</pre></div>
</div>
<p>Using the strategy above, one can quickly generate random circuits with all-to-all, long-range couplings.  These circuits generate unitaries that rapidly converge to Haar random unitaries, and they are difficult to simulate.</p>
<p>A much simpler class of random circuits, which we call <strong>local Hayden-Preskill circuits</strong>, can be generated using the same strategy as above, but in which the two qubit CZ gates are applied to nearest neighbour qubits instead of random pairs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Choose</span> <span class="n">a</span> <span class="n">random</span> <span class="n">qubit</span> <span class="n">j</span> <span class="kn">from</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Apply</span> <span class="n">CZ</span><span class="p">(</span><span class="n">qubit</span> <span class="n">j</span><span class="p">,</span> <span class="n">qubit</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<section id="in-this-notebook-we-will-focus-on-both-local-and-non-local-hayden-preskill-circuits-defined-using-the-helper-functions-below">
<h3>In this notebook, we will focus on both local and non-local Hayden-Preskill circuits, defined using the helper functions below.<a class="headerlink" href="#in-this-notebook-we-will-focus-on-both-local-and-non-local-hayden-preskill-circuits-defined-using-the-helper-functions-below" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">CZtuple_generator</span><span class="p">(</span><span class="n">qubits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Yields a CZ between a random qubit and its next nearest neighbor.</span>
<span class="sd">    For simplicity, we choose a random qubit from the first N-1 qubits for</span>
<span class="sd">    the control and we set the target to be qubit i+1, where i is the control.&quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">yield</span> <span class="n">Circuit</span><span class="p">()</span><span class="o">.</span><span class="n">cz</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="n">a</span><span class="p">],</span><span class="n">qubits</span><span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">local_Hayden_Preskill_generator</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="n">numgates</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Yields the circuit elements for a scrambling unitary.</span>
<span class="sd">    Generates a circuit with numgates gates by laying down a</span>
<span class="sd">    random gate at each time step.  Gates are chosen from single</span>
<span class="sd">    qubit unitary rotations by a random angle, Hadamard, or a </span>
<span class="sd">    controlled-Z between a qubit and its nearest neighbor (i.e.,</span>
<span class="sd">    incremented by 1).&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numgates</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span>
            <span class="n">Circuit</span><span class="p">()</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">()),</span>
            <span class="n">Circuit</span><span class="p">()</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">()),</span>
            <span class="n">Circuit</span><span class="p">()</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">()),</span>
            <span class="n">Circuit</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
            <span class="n">CZtuple_generator</span><span class="p">(</span><span class="n">qubits</span><span class="p">),</span> <span class="c1"># For all-to-all: Circuit().cz(*np.random.choice(qubits,2,replace=False)),</span>
            <span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
        
<span class="k">def</span> <span class="nf">non_local_Hayden_Preskill_generator</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="n">numgates</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Yields the circuit elements for a scrambling unitary.</span>
<span class="sd">    Generates a circuit with numgates gates by laying down a</span>
<span class="sd">    random gate at each time step.  Gates are chosen from single</span>
<span class="sd">    qubit unitary rotations by a random angle, Hadamard, or a </span>
<span class="sd">    controlled-Z between a qubit and its nearest neighbor (i.e.,</span>
<span class="sd">    incremented by 1).&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numgates</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span>
            <span class="n">Circuit</span><span class="p">()</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">()),</span>
            <span class="n">Circuit</span><span class="p">()</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">()),</span>
            <span class="n">Circuit</span><span class="p">()</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">()),</span>
            <span class="n">Circuit</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
            <span class="n">Circuit</span><span class="p">()</span><span class="o">.</span><span class="n">cz</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
            <span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>We use the helper functions above to generate local Hayden-Preskill (random) quantum circuits. For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate an example of a local Hayden Preskill circuit</span>
<span class="n">test_circuit</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>
<span class="n">test_circuit</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">local_Hayden_Preskill_generator</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="mi">20</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>T  : |   0    |    1    |    2    |3|    4     |5|6|7|8|9|
                                                          
q0 : -H------------------C---------C-Rx(0.389)--C-C-C-----
                         |         |            | | |     
q1 : -C--------Rx(0.37)--Z---------Z-Rx(0.464)--Z-Z-Z-----
      |                                                   
q2 : -Z--------Ry(0.508)-Rz(0.562)-C------------------C---
                                   |                  |   
q3 : -Rx(0.26)---------------------Z-Ry(0.0278)-C-C-C-Z-C-
                                                | | |   | 
q4 : -------------------------------------------Z-Z-Z---Z-

T  : |   0    |    1    |    2    |3|    4     |5|6|7|8|9|
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate an example of a non-local Hayden Preskill circuit</span>
<span class="n">test_circuit</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>
<span class="n">test_circuit</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">non_local_Hayden_Preskill_generator</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="mi">20</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>T  : | 0 |     1     |    2     |3|    4    |    5    |    6    |7|8|9|10 |   11    |
                                                                                     
q0 : -Z---C-----------Rz(0.0273)---C---------Ry(0.634)-------------------------------
      |   |                        |                                                 
q1 : -|---|-----------C----------C-Z-----------------------------Z-------C-----------
      |   |           |          |                               |       |           
q2 : -|---|-----------|----------Z-Ry(0.435)-Rx(0.527)-Rz(0.172)-C-C---Z-|-Ry(0.643)-
      |   |           |                                            |   | |           
q3 : -|-H-|-Rz(0.375)-|--------------------------------------------Z-Z-|-Z-----------
      |   |           |                                              | |             
q4 : -C---Z-----------Z----------H-Ry(0.921)-------------------------C-C-------------

T  : | 0 |     1     |    2     |3|    4    |    5    |    6    |7|8|9|10 |   11    |
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="simulating-local-random-circuits-using-the-tn1-tensor-network-simulator">
<h2>Simulating <em>local</em> random circuits using the TN1 tensor network simulator<a class="headerlink" href="#simulating-local-random-circuits-using-the-tn1-tensor-network-simulator" title="Permalink to this heading">#</a></h2>
<section id="testing-and-timing">
<h3>Testing and timing<a class="headerlink" href="#testing-and-timing" title="Permalink to this heading">#</a></h3>
<p>Let’s start with a reasonably sized circuit</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_qubits</span> <span class="o">=</span> <span class="mi">20</span>                     <span class="c1"># Number of qubits</span>
<span class="n">num_layers</span> <span class="o">=</span> <span class="mi">10</span>                     <span class="c1"># Number of layers.  A layer consists of num_qubits gates.</span>
<span class="n">numgates</span> <span class="o">=</span> <span class="n">num_qubits</span> <span class="o">*</span> <span class="n">num_layers</span>  <span class="c1"># Total number of gates.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">num_qubits</span><span class="si">}</span><span class="s2"> qubits, </span><span class="si">{</span><span class="n">num_layers</span><span class="si">}</span><span class="s2"> layers = </span><span class="si">{</span><span class="n">numgates</span><span class="si">}</span><span class="s2"> total gates&quot;</span><span class="p">)</span>
<span class="n">circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>
<span class="n">circ</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">local_Hayden_Preskill_generator</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">),</span> <span class="n">numgates</span><span class="p">));</span>  <span class="c1"># Create the circuit with numgates gates.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20 qubits, 10 layers = 200 total gates
</pre></div>
</div>
</div>
</div>
<p>Time this circuit using TN1.  It should take about a minute or so.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># define task</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running: </span><span class="si">{</span><span class="n">num_qubits</span><span class="si">}</span><span class="s2"> qubits, </span><span class="si">{</span><span class="n">num_layers</span><span class="si">}</span><span class="s2"> layers = </span><span class="si">{</span><span class="n">numgates</span><span class="si">}</span><span class="s2"> total gates&quot;</span><span class="p">)</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">poll_timeout_seconds</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># get id and status of submitted task</span>
<span class="n">task_id</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">id</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">state</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ID of task:&#39;</span><span class="p">,</span> <span class="n">task_id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Status of task:&#39;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>

<span class="c1"># wait for job to complete</span>
<span class="n">terminal_states</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;COMPLETED&#39;</span><span class="p">,</span> <span class="s1">&#39;FAILED&#39;</span><span class="p">,</span> <span class="s1">&#39;CANCELLED&#39;</span><span class="p">]</span>
<span class="k">while</span> <span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">terminal_states</span><span class="p">:</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="c1"># Update this for shorter circuits.</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">state</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Status:&#39;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>

<span class="c1"># get results of task</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

<span class="c1"># get measurement shots</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">measurement_counts</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">counts</span><span class="o">.</span><span class="n">values</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running: 20 qubits, 10 layers = 200 total gates
ID of task: arn:aws:braket:us-west-2:586882978732:quantum-task/4e870cf6-c25b-4457-b03d-b40e6438e96f
Status of task: CREATED
Status: RUNNING
Status: RUNNING
Status: COMPLETED
CPU times: user 895 ms, sys: 7.99 ms, total: 903 ms
Wall time: 1min 1s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;BarContainer object of 921 artists&gt;
</pre></div>
</div>
<img alt="../../_images/1137dce60939172c8366edd9798e6b4f5cfddc547f8eab16c55b1bd17f43e396.png" src="../../_images/1137dce60939172c8366edd9798e6b4f5cfddc547f8eab16c55b1bd17f43e396.png" />
</div>
</div>
</section>
<section id="the-importance-of-locality-in-circuits">
<h3>The importance of locality in circuits<a class="headerlink" href="#the-importance-of-locality-in-circuits" title="Permalink to this heading">#</a></h3>
<p>The goal of this section is to understand the importance of a local structure in quantum circuits being simulated in the tensor network simulator.  We will first generate and benchmark a local Hayden-Preskill circuit, and then we will re-run the exact same circuit with the qubits randomly permuted. By permuting the qubits, we produce a circuit that appears to be have non-local, long-range coupling, but for which we know that there exists an underlying local structure.</p>
<p>An example of a circuit and its permuted version is shown below.  A local Hayden-Preskill circuit is generated, and then a version of the same circuit is created in which the qubits are randomly permuted, according to the permutation [0,1,2,3,4,5]$\mapsto$[5,2,4,1,0,3].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;permuted_circuit.png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/71799ec5dd34e0e045879ae411d20eb9567cc5e4e6ff4d4cf6b2e46a218d3e74.png" src="../../_images/71799ec5dd34e0e045879ae411d20eb9567cc5e4e6ff4d4cf6b2e46a218d3e74.png" />
</div>
</div>
<p>With these two circuits (that seem to have vastly different locality, but which are “secretly” the same), we can explore the tensor network simulator’s ability to discern structure in a given circuit.</p>
<p>First generate a modest sized local Hayden-Preskill circuit.  Then make a copy of that circuit by permuting the qubit indices randomly.  We’ll compare the runtime to sample from the outputs of these two circuits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_qubits</span> <span class="o">=</span> <span class="mi">50</span>                     <span class="c1"># Number of qubits</span>
<span class="n">num_layers</span> <span class="o">=</span> <span class="mi">10</span>                     <span class="c1"># Number of layers.  A layer consists of num_qubits gates.</span>
<span class="n">numgates</span> <span class="o">=</span> <span class="n">num_qubits</span> <span class="o">*</span> <span class="n">num_layers</span>  <span class="c1"># Total number of gates.</span>
<span class="n">qubits</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span>            <span class="c1"># Generate the (1D) qubits</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">num_qubits</span><span class="si">}</span><span class="s2"> qubits, </span><span class="si">{</span><span class="n">num_layers</span><span class="si">}</span><span class="s2"> layers = </span><span class="si">{</span><span class="n">numgates</span><span class="si">}</span><span class="s2"> total gates&quot;</span><span class="p">)</span>

<span class="c1"># Generate the circuit with numgates gates acting on qubits.</span>
<span class="n">circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>
<span class="n">circ</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">local_Hayden_Preskill_generator</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="n">numgates</span><span class="p">));</span>

<span class="c1"># Choose a random permutation of the qubits</span>
<span class="n">permuted_qubits</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span>

<span class="c1"># Copy the circuit circ acting on the permuted qubits</span>
<span class="n">perm</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span><span class="o">.</span><span class="n">add_circuit</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span> <span class="n">target_mapping</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span> <span class="n">permuted_qubits</span><span class="p">)))</span>

<span class="c1">##Uncomment for testing:</span>
<span class="c1"># print(permuted_qubits)</span>
<span class="c1"># print(circ)</span>
<span class="c1"># print(perm)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>50 qubits, 10 layers = 500 total gates
</pre></div>
</div>
</div>
</div>
<p>Time both circuits using the tensor network simulator for a <strong>single shot</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># define task</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">poll_timeout_seconds</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># get results of task</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

<span class="c1"># get measurement shots</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running the local circuit with </span><span class="si">{</span><span class="n">num_qubits</span><span class="si">}</span><span class="s2"> qubits, </span><span class="si">{</span><span class="n">num_layers</span><span class="si">}</span><span class="s2"> layers = </span><span class="si">{</span><span class="n">numgates</span><span class="si">}</span><span class="s2"> total gates&quot;</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">measurement_counts</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sample was: </span><span class="si">{</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running the local circuit with 50 qubits, 10 layers = 500 total gates
The sample was: 01011001101000001000011100110000001011010001100100.
CPU times: user 100 ms, sys: 2.76 ms, total: 103 ms
Wall time: 10.6 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># define task</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">perm</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">poll_timeout_seconds</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># get results of task</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

<span class="c1"># get measurement shots</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running the non-local circuit with </span><span class="si">{</span><span class="n">num_qubits</span><span class="si">}</span><span class="s2"> qubits, </span><span class="si">{</span><span class="n">num_layers</span><span class="si">}</span><span class="s2"> layers = </span><span class="si">{</span><span class="n">numgates</span><span class="si">}</span><span class="s2"> total gates&quot;</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">measurement_counts</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sample was: </span><span class="si">{</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running the non-local circuit with 50 qubits, 10 layers = 500 total gates
The sample was: 11000010100100011011001010000100000110001000100001.
CPU times: user 161 ms, sys: 3.42 ms, total: 164 ms
Wall time: 28.2 s
</pre></div>
</div>
</div>
</div>
<p>If you repeat these experiments, you’ll find that the two runtimes are (typically) very similar! Even though the permuted circuit seems to be highly non-local at first glance, the simulator discovers the underlying local structure, and the total runtime is comparable to the manifestly local circuit. This similarity is due to the rehearsal phase of the tensor network simulation <span class="xref myst">[1]</span>. A sophisticated algorithm works behind the scenes to find an efficient path for contracting the tensor network. Thus, when the tensor network has an underlying structure, the tensor network simulator can often tease it out.</p>
</section>
</section>
<section id="simulating-non-local-random-circuits-using-the-tn1-tensor-network-simulator">
<h2>Simulating <em>non-local</em> random circuits using the TN1 tensor network simulator<a class="headerlink" href="#simulating-non-local-random-circuits-using-the-tn1-tensor-network-simulator" title="Permalink to this heading">#</a></h2>
<p>Let us now compare the efficiency of simulating local and genuinely non-local random quantum circuits. When using the non-local Hayden Preskill circuits above, the circuits we generate have no underlying structure, making them especially difficult for the tensor network simulator.</p>
<p>We will generate one local random circuit and one non-local quantum circuit of the same size, and we will compare their runtimes. In this section, the we will not be comparing identical quantum circuits as we were above, so our results can be understood by repeating these experiments several times and noting that our claims are true on average.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_qubits</span> <span class="o">=</span> <span class="mi">50</span>                     <span class="c1"># Number of qubits</span>
<span class="n">num_layers</span> <span class="o">=</span> <span class="mi">8</span>                      <span class="c1"># Number of layers.  A layer consists of num_qubits gates.</span>
<span class="n">numgates</span> <span class="o">=</span> <span class="n">num_qubits</span> <span class="o">*</span> <span class="n">num_layers</span>  <span class="c1"># Total number of gates.</span>
<span class="n">qubits</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span>            <span class="c1"># Generate the (1D) qubits</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">num_qubits</span><span class="si">}</span><span class="s2"> qubits, </span><span class="si">{</span><span class="n">num_layers</span><span class="si">}</span><span class="s2"> layers = </span><span class="si">{</span><span class="n">numgates</span><span class="si">}</span><span class="s2"> total gates&quot;</span><span class="p">)</span>

<span class="c1"># Generate the local circuit with numgates gates acting on qubits.</span>
<span class="n">localcirc</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>
<span class="n">localcirc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">local_Hayden_Preskill_generator</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="n">numgates</span><span class="p">));</span>

<span class="c1"># Generate the non-local circuit with numgates gates acting on qubits.</span>
<span class="n">nonlocalcirc</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>
<span class="n">nonlocalcirc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">non_local_Hayden_Preskill_generator</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="n">numgates</span><span class="p">));</span>

<span class="c1">##Uncomment for testing:</span>
<span class="c1"># print(permuted_qubits)</span>
<span class="c1"># print(circ)</span>
<span class="c1"># print(perm)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>50 qubits, 8 layers = 400 total gates
</pre></div>
</div>
</div>
</div>
<p>Run the local circuit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># define task</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">localcirc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">poll_timeout_seconds</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># get results of task</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

<span class="c1"># get measurement shots</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running the local circuit with </span><span class="si">{</span><span class="n">num_qubits</span><span class="si">}</span><span class="s2"> qubits, </span><span class="si">{</span><span class="n">num_layers</span><span class="si">}</span><span class="s2"> layers = </span><span class="si">{</span><span class="n">numgates</span><span class="si">}</span><span class="s2"> total gates&quot;</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">measurement_counts</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sample was: </span><span class="si">{</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running the local circuit with 50 qubits, 8 layers = 400 total gates
The sample was: 01000011010100011111010010101101000000000000111010.
CPU times: user 99.7 ms, sys: 436 µs, total: 100 ms
Wall time: 10.5 s
</pre></div>
</div>
</div>
</div>
<p>Run the non-local circuit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># define task</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">nonlocalcirc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">poll_timeout_seconds</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># get results of task</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

<span class="c1"># get measurement shots</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running the non-local circuit with </span><span class="si">{</span><span class="n">num_qubits</span><span class="si">}</span><span class="s2"> qubits, </span><span class="si">{</span><span class="n">num_layers</span><span class="si">}</span><span class="s2"> layers = </span><span class="si">{</span><span class="n">numgates</span><span class="si">}</span><span class="s2"> total gates&quot;</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">measurement_counts</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sample was: </span><span class="si">{</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running the non-local circuit with 50 qubits, 8 layers = 400 total gates
The sample was: 01000110001010011000000001001010001000001000111100.
CPU times: user 118 ms, sys: 13 ms, total: 131 ms
Wall time: 20.3 s
</pre></div>
</div>
</div>
</div>
<p>When running this notebook several times, we find that the non-local circuit generally takes 2-3 times longer to run than the local circuit. However, on occasion the non-local circuit fails to run, for a reason we will explore below.</p>
</section>
<section id="non-local-circuits-quickly-become-too-difficult-for-tensor-network-methods">
<h2>Non-local circuits quickly become too difficult for tensor network methods<a class="headerlink" href="#non-local-circuits-quickly-become-too-difficult-for-tensor-network-methods" title="Permalink to this heading">#</a></h2>
<p>In this section, we will compare larger circuits with and without locality. We will see that the local circuits execute very efficiently on the tensor network simulator, whereas the non-local circuits actually fail in the rehearsal phase.</p>
<p>We start by generating these larger circuits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_qubits</span> <span class="o">=</span> <span class="mi">50</span>                     <span class="c1"># Number of qubits</span>
<span class="n">num_layers</span> <span class="o">=</span> <span class="mi">20</span>                     <span class="c1"># Number of layers.  A layer consists of num_qubits gates.</span>
<span class="n">numgates</span> <span class="o">=</span> <span class="n">num_qubits</span> <span class="o">*</span> <span class="n">num_layers</span>  <span class="c1"># Total number of gates.</span>
<span class="n">qubits</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span>            <span class="c1"># Generate the (1D) qubits</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">num_qubits</span><span class="si">}</span><span class="s2"> qubits, </span><span class="si">{</span><span class="n">num_layers</span><span class="si">}</span><span class="s2"> layers = </span><span class="si">{</span><span class="n">numgates</span><span class="si">}</span><span class="s2"> total gates&quot;</span><span class="p">)</span>

<span class="c1"># Generate the circuit with numgates gates acting on qubits.</span>
<span class="n">localcirc</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>
<span class="n">localcirc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">local_Hayden_Preskill_generator</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="n">numgates</span><span class="p">));</span>

<span class="c1"># Generate the circuit with numgates gates acting on qubits.</span>
<span class="n">nonlocalcirc</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>
<span class="n">nonlocalcirc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">non_local_Hayden_Preskill_generator</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span><span class="n">numgates</span><span class="p">));</span>

<span class="c1">##Uncomment for testing:</span>
<span class="c1"># print(permuted_qubits)</span>
<span class="c1"># print(circ)</span>
<span class="c1"># print(perm)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>50 qubits, 20 layers = 1000 total gates
</pre></div>
</div>
</div>
</div>
<p>The local Hayden Preskill circuit executes in a reasonable amount of time, generally about a minute or so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># define task</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">localcirc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">poll_timeout_seconds</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># get results of task</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

<span class="c1"># get measurement shots</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running the local circuit with </span><span class="si">{</span><span class="n">num_qubits</span><span class="si">}</span><span class="s2"> qubits, </span><span class="si">{</span><span class="n">num_layers</span><span class="si">}</span><span class="s2"> layers = </span><span class="si">{</span><span class="n">numgates</span><span class="si">}</span><span class="s2"> total gates&quot;</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">measurement_counts</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sample was: </span><span class="si">{</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running the local circuit with 50 qubits, 20 layers = 1000 total gates
The sample was: 01010111001000001010000000100011110000110001110101.
CPU times: user 201 ms, sys: 7.95 ms, total: 209 ms
Wall time: 32.7 s
</pre></div>
</div>
</div>
</div>
<p>Conversely, the non-local Hayden Preskill circuit actually fails to execute:</p>
<div class="alert alert-block alert-info">
<b>Note:</b> The following cell can take several minutes to run on TN1. It is only present to illustrate a task that will result in a FAILED state.
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># define task</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">nonlocalcirc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">poll_timeout_seconds</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># get results of task</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

<span class="c1"># get measurement shots</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running the non-local circuit with </span><span class="si">{</span><span class="n">num_qubits</span><span class="si">}</span><span class="s2"> qubits, </span><span class="si">{</span><span class="n">num_layers</span><span class="si">}</span><span class="s2"> layers = </span><span class="si">{</span><span class="n">numgates</span><span class="si">}</span><span class="s2"> total gates&quot;</span><span class="p">)</span>
<span class="c1"># counts = result.measurement_counts</span>
<span class="c1"># print(f&quot;The sample was: {next(iter(counts))}.&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Task is in terminal state FAILED and no result is available
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running the non-local circuit with 50 qubits, 20 layers = 1000 total gates
CPU times: user 411 ms, sys: 19.4 ms, total: 431 ms
Wall time: 1min 56s
</pre></div>
</div>
</div>
</div>
<p>To see why this circuit <code class="docutils literal notranslate"><span class="pre">FAILED</span></code> to run, we can check the <code class="docutils literal notranslate"><span class="pre">failureReason</span></code> in the task’s <code class="docutils literal notranslate"><span class="pre">_metadata</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="s1">&#39;failureReason&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Predicted runtime based on best contraction path found exceeds TN1 limit. Single-shot FLOPS estimate = 2^105
</pre></div>
</div>
</div>
</div>
<p>Evidently, without any structure to exploit, this tensor network would take too long to simulate, and the simulator returns with a <code class="docutils literal notranslate"><span class="pre">FAILED</span></code> state.</p>
</section>
<section id="conclusions">
<h2>Conclusions<a class="headerlink" href="#conclusions" title="Permalink to this heading">#</a></h2>
<p>We saw that structured quantum circuits can be simulated much more efficiently than unstructured random quantum circuits. That said, structure in a quantum circuit may not be immediately evident, as the tensor network simulator was able to discover the hidden structure in our permuted quantum circuits, leading to efficiency on-par with their unpermuted, local counterparts. Note, however, that discovering this underlying structure is analogous to the graph isomorphism problem, and finding an efficient contraction path for a tensor network is a hard problem.</p>
</section>
<section id="appendix">
<h2>Appendix<a class="headerlink" href="#appendix" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check SDK version</span>
<span class="c1"># alternative: braket.__version__</span>
<span class="o">!</span>pip show amazon-braket-sdk <span class="p">|</span> grep Version
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Version: 1.5.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<p>[1] <a class="reference external" href="https://docs.aws.amazon.com/braket/latest/developerguide/braket-devices.html#braket-simulator-tn1">Amazon Braket Documentation: Tensor Network Simulator</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Task Summary&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">quantum_tasks_statistics</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This estimate does not inclued the task which fails after rehersal, for which charges may apply. See https://docs.aws.amazon.com/braket/latest/developerguide/braket-devices.html for more details.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated cost to run this example: </span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">qpu_tasks_cost</span><span class="p">()</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="n">simulator_tasks_cost</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> USD&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Task Summary
{&#39;arn:aws:braket:::device/quantum-simulator/amazon/tn1&#39;: {&#39;shots&#39;: 1006, &#39;tasks&#39;: {&#39;COMPLETED&#39;: 6, &#39;FAILED&#39;: 1}, &#39;execution_duration&#39;: datetime.timedelta(seconds=124, microseconds=18000), &#39;billed_execution_duration&#39;: datetime.timedelta(seconds=124, microseconds=18000)}}
Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).
This estimate does not inclued the task which fails after rehersal, for which charges may apply. See https://docs.aws.amazon.com/braket/latest/developerguide/braket-devices.html for more details.
Estimated cost to run this example: 0.568 USD
</pre></div>
</div>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Testing the tensor network simulator with 2-local Hayden-Preskill circuits</a><ul>
<li><a class="reference internal" href="#setup-the-tensor-network-simulator">Setup the tensor network simulator:</a></li>
<li><a class="reference internal" href="#local-hayden-preskill-circuits">Local Hayden-Preskill Circuits</a><ul>
<li><a class="reference internal" href="#in-this-notebook-we-will-focus-on-both-local-and-non-local-hayden-preskill-circuits-defined-using-the-helper-functions-below">In this notebook, we will focus on both local and non-local Hayden-Preskill circuits, defined using the helper functions below.</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simulating-local-random-circuits-using-the-tn1-tensor-network-simulator">Simulating <em>local</em> random circuits using the TN1 tensor network simulator</a><ul>
<li><a class="reference internal" href="#testing-and-timing">Testing and timing</a></li>
<li><a class="reference internal" href="#the-importance-of-locality-in-circuits">The importance of locality in circuits</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simulating-non-local-random-circuits-using-the-tn1-tensor-network-simulator">Simulating <em>non-local</em> random circuits using the TN1 tensor network simulator</a></li>
<li><a class="reference internal" href="#non-local-circuits-quickly-become-too-difficult-for-tensor-network-methods">Non-local circuits quickly become too difficult for tensor network methods</a></li>
<li><a class="reference internal" href="#conclusions">Conclusions</a></li>
<li><a class="reference internal" href="#appendix">Appendix</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    </body>
</html>