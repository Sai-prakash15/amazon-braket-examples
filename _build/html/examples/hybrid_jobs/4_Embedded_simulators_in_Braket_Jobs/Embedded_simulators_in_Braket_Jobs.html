<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>Embedded simulators in Braket Jobs - Amazon Braket Examples documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">Amazon Braket Examples  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">Amazon Braket Examples  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  
</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="embedded-simulators-in-braket-jobs">
<h1>Embedded simulators in Braket Jobs<a class="headerlink" href="#embedded-simulators-in-braket-jobs" title="Permalink to this heading">#</a></h1>
<p>In this notebook, we introduce embedded simulators in Braket Jobs. An embedded simulator is a local simulator that runs completely within a job instance, i.e., the compute resource that is running your algorithm script. In contrast, <a class="reference external" href="https://docs.aws.amazon.com/braket/latest/developerguide/braket-devices.html#braket-simulator-sv1">on-demand simulators</a>, such as SV1, DM1, or TN1, calculate the results of a quantum circuit on dedicated compute infrastructure on-demand by Amazon Braket. At a high level, hybrid workloads usually consist of iterations of quantum circuit executions and variational parameter optimizations. By using embedded simulators, we keep all computations in the same environment. This allows the optimization algorithm to access advanced features supported by the embedded simulator. For example, users could leverage advanced gradient computation methods, such as <a class="reference external" href="https://pennylane.readthedocs.io/en/stable/introduction/interfaces.html#simulation-based-differentiation">the adjoint and the backprop method</a>, for supported simulators via PennyLane. These methods rely on accessing the intermediate states of the wave function, which is not supported by Amazon Braket on-demand simulators or QPUs. Furthermore, with the <a class="reference external" href="https://docs.aws.amazon.com/braket/latest/developerguide/braket-jobs-byoc.html">Bring Your Own Container (BYOC)</a> feature of Jobs, users may choose to use open source simulators or their own proprietary simulation tools.</p>
<p>In contrast to running a local simulator in a manually set up <a class="reference external" href="https://aws.amazon.com/ec2/">Amazon EC2 instance</a> or in a user’s local environment, Hybrid Jobs manage the computational resources on your behalf. A job instance is automatically started when the job is created, and is ended when the job is finished, so you only pay for the resources you use. Users can submit multiple jobs at the same time to accelerate experimentation, e.g., during hyperparameter optimization. In addition, users can switch from an embedded simulator to other Amazon Braket devices, including QPUs, by changing the selected device when creating a job.</p>
<section id="specify-a-device-for-embedded-simulations">
<h2>Specify a device for embedded simulations<a class="headerlink" href="#specify-a-device-for-embedded-simulations" title="Permalink to this heading">#</a></h2>
<p>Typically, when creating a job, you assign the <code class="docutils literal notranslate"><span class="pre">device</span></code> argument of <code class="docutils literal notranslate"><span class="pre">AwsQuantumJob.create()</span></code> to the ARN (Amazon Resource Name) of an on-demand simulator or a QPU. To select an embedded simulator, you instead specify the <code class="docutils literal notranslate"><span class="pre">device</span></code> argument to be a string of the form: <br>
<code class="docutils literal notranslate"><span class="pre">device</span> <span class="pre">=</span> <span class="pre">&quot;local:&lt;provider&gt;/&lt;simulator_name&gt;&quot;</span></code> <br>
Note that, <code class="docutils literal notranslate"><span class="pre">&lt;provider&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;simulator_name&gt;</span></code> must consist only of letters, numbers, <code class="docutils literal notranslate"><span class="pre">_</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code> and <code class="docutils literal notranslate"><span class="pre">.</span></code>. For example, to use the Amazon Braket local simulator through the <a class="reference external" href="https://github.com/aws/amazon-braket-pennylane-plugin-python">Braket-Pennylane plugin</a>, you would write:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;local:braket/braket.local.qubit&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>The algorithm script can access the string in <code class="docutils literal notranslate"><span class="pre">device</span></code> through the environment variable <code class="docutils literal notranslate"><span class="pre">&quot;AMZN_BRAKET_DEVICE_ARN&quot;</span></code>. Braket service does not perform logic on <code class="docutils literal notranslate"><span class="pre">&lt;provider&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;simulator_name&gt;</span></code>. Users can specify <code class="docutils literal notranslate"><span class="pre">&lt;provider&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;simulator_name&gt;</span></code> for their custom logic in the algorithm script to create any simulators. In this notebook, we use simulators through Braket-PennyLane plugin. We prepare a helper function <code class="docutils literal notranslate"><span class="pre">get_device()</span></code> as a part of the algorithm script to parse the <code class="docutils literal notranslate"><span class="pre">device</span></code> variable and set up the Pennylane <code class="docutils literal notranslate"><span class="pre">qml.device</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>cat qaoa/utils.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>import pennylane as qml
import os

def get_device(n_wires):
    device_string = os.environ[&quot;AMZN_BRAKET_DEVICE_ARN&quot;]
    device_prefix = device_string.split(&quot;:&quot;)[0]

    if device_prefix==&quot;local&quot;:
        prefix, device_name = device_string.split(&quot;/&quot;)
        device = qml.device(device_name, 
                            wires=n_wires, 
                            custom_decomps={&quot;MultiRZ&quot;: qml.MultiRZ.compute_decomposition})
        print(&quot;Using local simulator: &quot;, device.name)
    else:
        device = qml.device(&#39;braket.aws.qubit&#39;, 
                             device_arn=device_string, 
                             s3_destination_folder=None,
                             wires=n_wires,
                             parallel=True,
                             max_parallel=30)
        print(&quot;Using AWS on-demand device: &quot;, device.name)
        
    return device
</pre></div>
</div>
</div>
</div>
</section>
<section id="submit-a-job-with-an-embedded-simulator">
<h2>Submit a job with an embedded simulator<a class="headerlink" href="#submit-a-job-with-an-embedded-simulator" title="Permalink to this heading">#</a></h2>
<p>In this example, we use Hybrid Jobs with an embedded simulator to run a QAOA algorithm on the Max-Clique problem  which tries to find the largest set of fully-connected nodes in a graph. You can learn more about the details of this example in the notebook <a class="reference external" href="https://github.com/aws/amazon-braket-examples/blob/main/examples/pennylane/2_Graph_optimization_with_QAOA/2_Graph_optimization_with_QAOA.ipynb">graph optimization notebook</a>. The QAOA algorithm for our job is defined in <a class="reference external" href="https://github.com/aws/amazon-braket-examples/blob/main/examples/hybrid_jobs/4_Embedded_simulators_in_Braket_Jobs/qaoa/qaoa_algorithm.py">qaoa_algorithm.py</a>. The algorithm requires hyperparameters that are related to setting up the Max-Clique problem, such as n_nodes and n_edges, and also the ones related to training itself, such as the number of iterations and the step size.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hyperparameters</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;n_nodes&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> 
    <span class="s2">&quot;n_edges&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> 
    <span class="s2">&quot;n_layers&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;iterations&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;stepsize&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s2">&quot;diff_method&quot;</span><span class="p">:</span> <span class="s2">&quot;parameter-shift&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Since the algorithm is written is PennyLane you need to select a corresponding container. There are two pre-configured containers that include PennyLane, the PyTorch and the TensorFlow containers. See the <a class="reference external" href="https://docs.aws.amazon.com/braket/latest/developerguide/braket-jobs-script-environment.html">developer guide</a> to learn more about pre-configured containers. Let’s use the PyTorch container.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">braket.aws</span> <span class="kn">import</span> <span class="n">AwsSession</span>
<span class="kn">from</span> <span class="nn">braket.jobs.image_uris</span> <span class="kn">import</span> <span class="n">Framework</span><span class="p">,</span> <span class="n">retrieve_image</span>

<span class="n">region</span> <span class="o">=</span> <span class="n">AwsSession</span><span class="p">()</span><span class="o">.</span><span class="n">region</span>
<span class="n">image_uri</span> <span class="o">=</span> <span class="n">retrieve_image</span><span class="p">(</span><span class="n">Framework</span><span class="o">.</span><span class="n">PL_PYTORCH</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">image_uri</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>292282985366.dkr.ecr.us-east-1.amazonaws.com/amazon-braket-pytorch-jobs:1.8.1-cpu-py37-ubuntu18.04
</pre></div>
</div>
</div>
</div>
<p>When using embedded simulators in Hybrid Jobs, the circuits are executed on the job instance. For simulations that requires larger computational resources, such as simulating circuits with many qubits, choosing a job instance with a higher number of cores or larger memory may be required. For gpu-based simulators, such as lightning.gpu, you need to select a GPU instance. You can use the <code class="docutils literal notranslate"><span class="pre">InstanceConfig</span></code> argument to configure the instance for your job. The available instance types are listed in the <a class="reference external" href="https://docs.aws.amazon.com/braket/latest/APIReference/API_InstanceConfig.html">developer guide</a>. Let’s use a general purpose instance type (ml.m5.large) for now.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">braket.jobs.config</span> <span class="kn">import</span> <span class="n">InstanceConfig</span>

<span class="n">instance_config</span> <span class="o">=</span> <span class="n">InstanceConfig</span><span class="p">(</span><span class="n">instanceType</span><span class="o">=</span><span class="s1">&#39;ml.m5.large&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You can easily switch between different device using the <code class="docutils literal notranslate"><span class="pre">device</span></code> argument. In the following cell you can uncomment one of the three lines to use either the Braket local simulator, Pennylane default.qubit simulator, or the on-demand state vector simulator SV1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span><span class="o">=</span><span class="s2">&quot;local:braket/braket.local.qubit&quot;</span> <span class="c1"># Using Braket local simulator</span>
<span class="c1"># device=&quot;local:pennylane/default.qubit&quot; # Using Pennylane default.qubit simulator</span>
<span class="c1"># device=&quot;arn:aws:braket:::device/quantum-simulator/amazon/sv1&quot; # Using Braket on-demand SV1 </span>
</pre></div>
</div>
</div>
</div>
<p>Let’s now submit the job! At a minimum, you have to specify the device, source_module, and entry_point arguments. But you can customize your job with other arguments, including the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">device</span></code>: The specification of a embedded simulator that follows the syntax of <code class="docutils literal notranslate"><span class="pre">&quot;local:&lt;provider&gt;/&lt;simulator_name&gt;&quot;</span></code>, or the arn of the Braket on-demand simulator or QPU you want to use. It will be stored as an environment variable for the algorithm script.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source_module</span></code>: The path to a file or a python module that contains your algorithm script. It will be uploaded to the container for Braket Job execution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">entry_point</span></code>: The path relative to the source_module. It points to the piece of code to be executed when the Braket Job starts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hyperparameters</span></code>: The Python dictionary containing the hyperparameter names and values as strings. (optional)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">job_name</span></code>: A unique string to identify the job. It appears in the Braket Job console and in the job arn. (optional)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">instance_config</span></code>: The configuration of the instances used to execute the job. Default to <code class="docutils literal notranslate"><span class="pre">InstanceConfig(instanceType='ml.m5.large',</span> <span class="pre">volumeSizeInGb=30)</span></code>. (optional)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">image_uri</span></code>: The path to a Docker container image. (optional)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wait_until_complete</span></code>: If True, the function call will wait until the job is completed, and will additionally print logs to the local console. Otherwise, it will run asynchronously. Defaults to False. (optional)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">braket.aws</span> <span class="kn">import</span> <span class="n">AwsQuantumJob</span>

<span class="n">job</span> <span class="o">=</span> <span class="n">AwsQuantumJob</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
    <span class="n">source_module</span><span class="o">=</span><span class="s2">&quot;qaoa&quot;</span><span class="p">,</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="s2">&quot;qaoa.qaoa_algorithm&quot;</span><span class="p">,</span>
    <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;embedded-simulation-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())),</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="n">hyperparameters</span><span class="p">,</span>
    <span class="n">instance_config</span><span class="o">=</span><span class="n">instance_config</span><span class="p">,</span>
    <span class="n">image_uri</span><span class="o">=</span><span class="n">image_uri</span><span class="p">,</span>
    <span class="n">wait_until_complete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This cell should take about 6 minutes</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;params&#39;: [[0.9170388720505319, 0.7204929371752294, 1.4528933994269753], [1.3895487869726206, 0.9665264386809151, -0.47009700306676794]], &#39;cost&#39;: -0.5536775832039897}
</pre></div>
</div>
</div>
</div>
</section>
<section id="custom-gradient-computation-methods">
<h2>Custom gradient computation methods<a class="headerlink" href="#custom-gradient-computation-methods" title="Permalink to this heading">#</a></h2>
<p>The <a class="reference external" href="https://pennylane.ai/qml/glossary/parameter_shift.html">parameter-shift rule</a> is a general method for computing gradients of a cost function with respect to the variational parameters of a quantum circuit. With the parameter-shift rule, the gradient is calculated exactly by running the same circuit multiple times with shifted parameters. Running all shifted circuits can take a long time unless using highly parallel simulators like SV1. Even then, the number of circuits scales linearly with the number of parameters. In contrast, other gradient methods, such as adjoint differentiation, require fewer circuit executions, at the cost of increase memory requirements.</p>
<p>For example, we can use the adjoint method for PennyLane’s default.qubit simulator via the <code class="docutils literal notranslate"><span class="pre">diff_method</span></code> variable in the hyperparameters. Note that Amazon Braket on-demand simulators can only use the parameter-shift method in PennyLane.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hyperparameters</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;n_nodes&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> 
    <span class="s2">&quot;n_edges&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> 
    <span class="s2">&quot;n_layers&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;iterations&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;stepsize&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s2">&quot;diff_method&quot;</span><span class="p">:</span> <span class="s2">&quot;adjoint&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span> <span class="o">=</span> <span class="n">AwsQuantumJob</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;local:pennylane/default.qubit&quot;</span><span class="p">,</span>
    <span class="n">source_module</span><span class="o">=</span><span class="s2">&quot;qaoa&quot;</span><span class="p">,</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="s2">&quot;qaoa.qaoa_algorithm&quot;</span><span class="p">,</span>
    <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;embedded-simulation-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())),</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="n">hyperparameters</span><span class="p">,</span>
    <span class="n">instance_config</span><span class="o">=</span><span class="n">instance_config</span><span class="p">,</span>
    <span class="n">image_uri</span><span class="o">=</span><span class="n">image_uri</span><span class="p">,</span>
    <span class="n">wait_until_complete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This cell should take about 6 minutes</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;params&#39;: [[0.9170388720505317, 0.7204929371752299, 1.4528933994269748], [1.3895487869726197, 0.9665264386809147, -0.47009700306676944]], &#39;cost&#39;: -0.5536775832039891}
</pre></div>
</div>
</div>
</div>
</section>
<section id="accelerate-your-simulations-with-lightning-gpu-and-cuquantum">
<h2>Accelerate your simulations with <code class="docutils literal notranslate"><span class="pre">lightning.gpu</span></code> and cuQuantum<a class="headerlink" href="#accelerate-your-simulations-with-lightning-gpu-and-cuquantum" title="Permalink to this heading">#</a></h2>
<p>The PyTorch and the TensorFlow <a class="reference external" href="https://docs.aws.amazon.com/braket/latest/developerguide/braket-jobs-script-environment.html?tag=local002-20">job containers</a> are pre-configured with <a class="reference external" href="https://developer.nvidia.com/cuquantum-sdk">NVIDIA cuQuantum library</a> and PennyLane’s <a class="reference external" href="https://github.com/PennyLaneAI/pennylane-lightning-gpu">GPU simulator</a>, <code class="docutils literal notranslate"><span class="pre">lightning.gpu</span></code>. The GPU simulator accelerates circuit simulations for bigger circuits, and increases the number of qubits that can be simulated within a given time. To use <code class="docutils literal notranslate"><span class="pre">lightning.gpu</span></code>, we need to choose a GPU instance. Braket Jobs support these instances type that are compatible with <code class="docutils literal notranslate"><span class="pre">lightning.gpu</span></code>:</p>
<ul class="simple">
<li><p>p3.2xlarge</p></li>
<li><p>p3.8xlarge</p></li>
<li><p>p3.16xlarge</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">instance_config</span> <span class="o">=</span> <span class="n">InstanceConfig</span><span class="p">(</span><span class="n">instanceType</span><span class="o">=</span><span class="s1">&#39;ml.p3.2xlarge&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The GPU simulator also supports the <code class="docutils literal notranslate"><span class="pre">adjoint</span></code> gradient method which can greatly speed up the gradient evaluation compared to using the parameter-shift rule. In the following, we create a job to solve a 22-node Max-Clique problem using QAOA which requires simulating circuits with 22 qubits. It takes <code class="docutils literal notranslate"><span class="pre">lightning.gpu</span></code> roughly 1 minute for each optimization step, while it takes <code class="docutils literal notranslate"><span class="pre">lightning.qubit</span></code>, a CPU-based simulator, roughly 12 minutes. It is important to note that the run time depends on the size of the circuit, the problem type and the computational resource. You may see a different behavior of performance on a different problem or with a different instance type. In general, CPU-based simulators are suitable for running smaller circuits while GPU-based simulators perform better for the bigger circuits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hyperparameters</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;n_nodes&quot;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> 
    <span class="s2">&quot;n_edges&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> 
    <span class="s2">&quot;n_layers&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;iterations&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;stepsize&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s2">&quot;diff_method&quot;</span><span class="p">:</span> <span class="s2">&quot;adjoint&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Note:</strong> The following cell may be unable to complete with the default resource limits. You may contact <a class="reference external" href="https://support.console.aws.amazon.com/support/home#/case/create?issueType=service-limit-increase">AWS Support</a> to increase the limits on your account.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span> <span class="o">=</span> <span class="n">AwsQuantumJob</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;local:pennylane/lightning.gpu&quot;</span><span class="p">,</span>
    <span class="n">source_module</span><span class="o">=</span><span class="s2">&quot;qaoa&quot;</span><span class="p">,</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="s2">&quot;qaoa.qaoa_algorithm&quot;</span><span class="p">,</span>
    <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;embedded-simulation-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())),</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="n">hyperparameters</span><span class="p">,</span>
    <span class="n">instance_config</span><span class="o">=</span><span class="n">instance_config</span><span class="p">,</span>
    <span class="n">image_uri</span><span class="o">=</span><span class="n">image_uri</span><span class="p">,</span>
    <span class="n">wait_until_complete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This cell should take about 9 minutes</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;params&#39;: [[0.2745401195836843, 1.0507143041933296, 0.831993939751942], [0.6986584818507686, 0.25601863649339063, 0.05599452108606921]], &#39;cost&#39;: 14.277212692531803}
</pre></div>
</div>
</div>
</div>
</section>
<section id="debug-with-local-mode">
<h2>Debug with local mode<a class="headerlink" href="#debug-with-local-mode" title="Permalink to this heading">#</a></h2>
<p>It is often useful to debug your program locally before submitting a job. You can run jobs with embedded simulation locally in your own environment for faster testing and debugging. This feature requires Docker to be installed in your programming environment. Amazon Braket notebooks have Docker pre-installed, but if you want to test your code locally, say, on your laptop, you need to install Docker. You can for instance follow these <a class="reference external" href="https://docs.docker.com/get-docker/">instructions</a>.</p>
<p>In local mode, a container is created in your local environment and the algorithm is run in that container. To run a job in local mode, make sure the Docker daemon is running, which is already the case for when you use Amazon Braket notebook instances. Then, create a <code class="docutils literal notranslate"><span class="pre">LocalQuantumJob</span></code> instead of an <code class="docutils literal notranslate"><span class="pre">AwsQuantumJob</span></code>. Local jobs always run synchronously and display the logs, so there is no <code class="docutils literal notranslate"><span class="pre">wait_until_complete</span></code> argument. Because a job in local mode runs in your own environment, there is no <code class="docutils literal notranslate"><span class="pre">instance_config</span></code> argument.  When a local job is created for the first time, it will take longer because it needs to build the container. The subsequent runs will be faster. Note that local jobs will not be visible in the Amazon Braket Console.  In local mode, you can still send quantum tasks to actual devices, but you do not get the performance benefits when running against an actual QPU while in local mode. To learn more about local mode, see the <a class="reference external" href="https://docs.aws.amazon.com/braket/latest/developerguide/braket-jobs-local-mode.html">developer guide</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hyperparameters</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;n_nodes&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> 
    <span class="s2">&quot;n_edges&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> 
    <span class="s2">&quot;n_layers&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;iterations&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;stepsize&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s2">&quot;diff_method&quot;</span><span class="p">:</span> <span class="s2">&quot;adjoint&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">braket.jobs.local.local_job</span> <span class="kn">import</span> <span class="n">LocalQuantumJob</span>

<span class="c1"># This cell should take about 3 min for the first time, and about 30 seconds afterward.</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">LocalQuantumJob</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;local:pennylane/default.qubit&quot;</span><span class="p">,</span>
    <span class="n">source_module</span><span class="o">=</span><span class="s2">&quot;qaoa&quot;</span><span class="p">,</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="s2">&quot;qaoa.qaoa_algorithm&quot;</span><span class="p">,</span>
    <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;embedded-simulation-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())),</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="n">hyperparameters</span><span class="p">,</span>
    <span class="n">image_uri</span><span class="o">=</span><span class="n">image_uri</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Boto3 Version:  1.20.10
Beginning Setup
Running Code As Subprocess
hyperparams:  {&#39;n_nodes&#39;: &#39;6&#39;, &#39;n_edges&#39;: &#39;8&#39;, &#39;n_layers&#39;: &#39;3&#39;, &#39;iterations&#39;: &#39;10&#39;, &#39;stepsize&#39;: &#39;0.1&#39;, &#39;seed&#39;: &#39;42&#39;, &#39;diff_method&#39;: &#39;adjoint&#39;}
Using local simulator:  Default qubit PennyLane plugin
number of observables:  13
start optimizing...
Metrics - timestamp=1650981956.9732826; Cost=4.570568368761232; iteration_number=0;
Metrics - timestamp=1650981957.2702165; Cost=2.614814968463016; iteration_number=1;
Metrics - timestamp=1650981957.557412; Cost=1.04216221000676; iteration_number=2;
Metrics - timestamp=1650981957.8734257; Cost=0.28694967085390216; iteration_number=3;
Metrics - timestamp=1650981958.1137834; Cost=-0.2527990816917891; iteration_number=4;
Metrics - timestamp=1650981958.350162; Cost=-0.5599800238018444; iteration_number=5;
Metrics - timestamp=1650981958.5563917; Cost=-0.5452012711678225; iteration_number=6;
Metrics - timestamp=1650981958.7647054; Cost=-0.4655467626418747; iteration_number=7;
Metrics - timestamp=1650981958.9726927; Cost=-0.48559573202749795; iteration_number=8;
Metrics - timestamp=1650981959.1799726; Cost=-0.5284214035178882; iteration_number=9;
Metrics - timestamp=1650981959.3860073; Cost=-0.5536775832039891; iteration_number=10;
Training Successful!!
Code Run Finished
</pre></div>
</div>
</div>
</div>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<p>In this notebook we showed you how to get started with running simulators embedded in Hybrid Jobs. To learn more, you can read the <a class="reference external" href="https://docs.aws.amazon.com/braket/latest/developerguide/braket-jobs.html">documentation</a> or follow the other example notebooks in this repo.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Embedded simulators in Braket Jobs</a><ul>
<li><a class="reference internal" href="#specify-a-device-for-embedded-simulations">Specify a device for embedded simulations</a></li>
<li><a class="reference internal" href="#submit-a-job-with-an-embedded-simulator">Submit a job with an embedded simulator</a></li>
<li><a class="reference internal" href="#custom-gradient-computation-methods">Custom gradient computation methods</a></li>
<li><a class="reference internal" href="#accelerate-your-simulations-with-lightning-gpu-and-cuquantum">Accelerate your simulations with <code class="docutils literal notranslate"><span class="pre">lightning.gpu</span></code> and cuQuantum</a></li>
<li><a class="reference internal" href="#debug-with-local-mode">Debug with local mode</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    </body>
</html>