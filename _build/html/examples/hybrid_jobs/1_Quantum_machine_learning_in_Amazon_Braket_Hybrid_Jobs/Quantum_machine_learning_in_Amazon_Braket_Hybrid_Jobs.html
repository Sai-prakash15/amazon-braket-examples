<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>Quantum machine learning in Amazon Braket Hybrid Jobs - Amazon Braket Examples documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">Amazon Braket Examples  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">Amazon Braket Examples  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  
</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="quantum-machine-learning-in-amazon-braket-hybrid-jobs">
<h1>Quantum machine learning in Amazon Braket Hybrid Jobs<a class="headerlink" href="#quantum-machine-learning-in-amazon-braket-hybrid-jobs" title="Permalink to this heading">#</a></h1>
<p>This notebook demonstrates a typical quantum machine learning workflow, including uploading data, monitoring training, and tuning hyperparameters. We focus on training a parameterized quantum circuit for an unsupervised generative modelling task.</p>
<section id="learning-outcomes">
<h2>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Set input data</p></li>
<li><p>Set hyperparameters</p></li>
<li><p>Submit multiple jobs asynchronously</p></li>
<li><p>Monitor job progress via the AWS Console</p></li>
<li><p>Download and plot results</p></li>
</ul>
</section>
<section id="background-generative-modelling">
<h2>Background: Generative modelling<a class="headerlink" href="#background-generative-modelling" title="Permalink to this heading">#</a></h2>
<p>Generative modelling is an unsupervised learning task where the goal is to generate new synthetic samples from an unknown target probability distribution. We denote the target probability distribution as $p(x)$, and the estimated distribution as $p_{\theta}(x)$. The goal is to learn $p_{\theta}(x)$ that closely resembles the target $p(x)$.  One metric to quantify the difference between probability distributions is the maximum mean discrepancy (MMD) loss .</p>
<p>$$MMD(x, y) = \sum_{j=1}^N \sum_{j’=1}^N k(y_j, y_{j’}) + \sum_{i=1}^N \sum_{i’=1}^N k(x_i, x_{i’})  - 2 \sum_{j=1}^N \sum_{i=1}^N k(y_j, x_i)$$
where $x$ is a sample from the target data $p(x)$, $y$ is a sample from the generative model $p_{\theta}(x)$, and $k$ is a Gaussian kernel</p>
<p>$$ k(x,y)= \sum_{\sigma} e^{-(x-y)^2/(2 \sigma^2))}$$</p>
<p>The MMD loss is zero if and only if $p(x)=p_{\theta}(x)$ for all $x$.</p>
<p>Learning a good approximation $p_{\theta}$ depends on the expressibility of the model, the effectiveness of the training algorithm, and the ability to sample the circuit efficiently.</p>
</section>
<section id="quantum-circuit-born-machine">
<h2>Quantum Circuit Born Machine<a class="headerlink" href="#quantum-circuit-born-machine" title="Permalink to this heading">#</a></h2>
<p>Quantum circuits are a natural fit for generative modelling because they are inherently probabilistic; the wavefunction encodes a probability according to the Born rule:</p>
<p>$$p(x)=|\langle x|\psi\rangle|^2$$</p>
<p>In quantum mechanics, we do not have access to $p(x)$ directly, but we can efficiently sample using projective measurements [1]. This is an implicit generative model similar to generative adversarial networks (GANs). Quantum circuits allow fast sampling from a high-dimension distribution, and have large expressive power.</p>
<p>The QCBM in this tutorial consists of alternating layers of single qubit rotations ($RX, RZ, RX$), followed by an entangling layer of CNot gates on each neighboring qubits. The final measurement layer computes the bit string samples of each outcome. Run the cell below to print a circuit diagram of a QCBM with randomly initialized parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">braket.devices</span> <span class="kn">import</span> <span class="n">LocalSimulator</span>
<span class="kn">from</span> <span class="nn">qcbm.qcbm</span> <span class="kn">import</span> <span class="n">QCBM</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">n_qubits</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">n_layers</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">init_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">n_layers</span> <span class="o">*</span> <span class="n">n_qubits</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">LocalSimulator</span><span class="p">()</span>
<span class="n">qcbm</span> <span class="o">=</span> <span class="n">QCBM</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">n_qubits</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qcbm</span><span class="o">.</span><span class="n">create_circuit</span><span class="p">(</span><span class="n">init_params</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>T  : |     0     |    1    |    2     |3|4|5|Result Types|
                                                          
q0 : -Rx(0.875)---Rz(0.321)-Rx(0.449)--C---X-Probability--
                                       |   | |            
q1 : -Rx(0.872)---Rz(0.615)-Rx(0.0769)-X-C-|-Probability--
                                         | | |            
q2 : -Rx(0.00923)-Rz(0.352)-Rx(0.942)----X-C-Probability--

T  : |     0     |    1    |    2     |3|4|5|Result Types|
</pre></div>
</div>
</div>
</div>
</section>
<section id="problem-setup">
<h2>Problem setup<a class="headerlink" href="#problem-setup" title="Permalink to this heading">#</a></h2>
<p>This notebook demonstrates training a QCBM on a toy data set using Amazon Braket Hybrid Jobs. The code for the QCBM is in <code class="docutils literal notranslate"><span class="pre">qcbm</span></code> directory. The <code class="docutils literal notranslate"><span class="pre">qcbm_job.py</span></code> contains the code that will run when we create a Braket Job. The other file (<code class="docutils literal notranslate"><span class="pre">qcbm.py</span></code>) contain the source code for the QCBM.</p>
<p>In this tutorial, we use a small number of qubits to make it quick to test the algorithm. We use the on-demand simulator SV1 to run our circuits and gradient calculations in parallel (up to 35 concurrent tasks).</p>
<p>We first set the number of qubits we want to use in our problem:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_qubits</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generate-data">
<h2>Generate data<a class="headerlink" href="#generate-data" title="Permalink to this heading">#</a></h2>
<p>As an example, we consider the toy example of learning a mixture of Gaussian distributions. We set a numpy random seed to produce the same data each time, but try experimenting with the number of peaks and number of qubits to produce harder or easier data sets. For this example, the target distribution $p(x)$ is a Gaussian on 5 bits (so $2^5$ possible values), with peaks at $\mu_1=7$ and $\mu_2=20$, with standard deviations $\sigma_1=1$, $\sigma_2 = 2$. We generate and plot the data as a probability density function in the cell below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline 

<span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">n_qubits</span><span class="p">)</span>
    <span class="n">gaussian</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mf">1.0</span>
        <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">gaussian</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">gaussian</span><span class="p">)</span>


<span class="n">data</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;{0:</span><span class="si">{fill}</span><span class="s2">6b}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">n_qubits</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))],</span> <span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Sample&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Two-peak Gaussian distribution&quot;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/835ec774398bbb233c9eb1f35f8ef13eb2256ac6e255476f0ca4efb2709eca1f.png" src="../../../_images/835ec774398bbb233c9eb1f35f8ef13eb2256ac6e255476f0ca4efb2709eca1f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;data.npy&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="c1"># save data to file</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="upload-data">
<h1>Upload data<a class="headerlink" href="#upload-data" title="Permalink to this heading">#</a></h1>
<p>To run our algorithm as a Hybrid Job, we need to input the data to the job. There are two primary ways to pass data to a Braket Job.</p>
<ol class="arabic simple">
<li><p>Firstly, we could pass the name of a local file as a string. In this example, it would be “data.npy”. In the algorithm script (<code class="docutils literal notranslate"><span class="pre">qcbm_job.py</span></code>), we would then load the file with <code class="docutils literal notranslate"><span class="pre">f&quot;{input_dir}/input/data.npy&quot;</span></code> since <code class="docutils literal notranslate"><span class="pre">&quot;input&quot;</span></code> is the default S3 channel used by Braket Jobs. We create the job with</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">AwsQuantumJob</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="s2">&quot;data.npy&quot;</span><span class="p">,</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Secondly, we could directly upload the data to S3 and point the job to that bucket. In the cell below, we provide a utility function that uploads the data to S3 with the name <code class="docutils literal notranslate"><span class="pre">filename</span></code> under the directory <code class="docutils literal notranslate"><span class="pre">dir_name</span></code> in the default bucket. Optionally, we can pass a specific AwsSession to customize where the data is saved. The S3 path would be passed to create a job similarly:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">AwsQuantumJob</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">s3_path</span><span class="p">,</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Upload dataset to S3</span>
<span class="kn">from</span> <span class="nn">braket.aws</span> <span class="kn">import</span> <span class="n">AwsSession</span>

<span class="k">def</span> <span class="nf">setup_input_stream</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">dir_name</span><span class="o">=</span><span class="s2">&quot;job-data&quot;</span><span class="p">,</span> <span class="n">aws_session</span><span class="o">=</span><span class="n">AwsSession</span><span class="p">()):</span>
    <span class="n">stream_s3_uri</span> <span class="o">=</span> <span class="n">aws_session</span><span class="o">.</span><span class="n">construct_s3_uri</span><span class="p">(</span><span class="n">aws_session</span><span class="o">.</span><span class="n">default_bucket</span><span class="p">(),</span> <span class="n">dir_name</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stream_s3_uri</span><span class="si">}</span><span class="s2">/&quot;</span> <span class="o">+</span> <span class="n">filename</span>
    <span class="n">aws_session</span><span class="o">.</span><span class="n">upload_to_s3</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s3_path</span> <span class="o">=</span> <span class="n">setup_input_stream</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;data.npy&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s3_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>s3://amazon-braket-&lt;region&gt;-&lt;account-id&gt;/job-data/data.npy
</pre></div>
</div>
</div>
</div>
<p>As a double check, try navigating to this S3 bucket using the AWS Console to verify the data was successfully uploaded.</p>
<section id="hyperparameters">
<h2>Hyperparameters<a class="headerlink" href="#hyperparameters" title="Permalink to this heading">#</a></h2>
<p>Next, we set the hyperparameters for our training job. To keep it simple, we only consider the following hyperparameters: number of qubits <code class="docutils literal notranslate"><span class="pre">n_qubits</span></code>, number of layers in the QCBM <code class="docutils literal notranslate"><span class="pre">n_layers</span></code>, and the number of iterations in the optimization algorithm.</p>
<p>The number of layers determines how many parameters are in the quantum circuit. For the QCBM, we need <code class="docutils literal notranslate"><span class="pre">n_params</span> <span class="pre">=</span> <span class="pre">3</span> <span class="pre">*</span> <span class="pre">n_layers</span> <span class="pre">*</span> <span class="pre">n_qubits</span></code>.</p>
<p>Note that the hyperparameters are defined in a Python dictionary of strings. Within the <code class="docutils literal notranslate"><span class="pre">qcbm_job.py</span></code> script, we will need to convert from strings back into integers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Declare hyperparameters for QCBM</span>

<span class="n">n_iterations</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">n_layers</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">hyperparams</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;n_qubits&quot;</span><span class="p">:</span> <span class="n">n_qubits</span><span class="p">,</span>
    <span class="s2">&quot;n_layers&quot;</span><span class="p">:</span> <span class="n">n_layers</span><span class="p">,</span>
    <span class="s2">&quot;n_iterations&quot;</span><span class="p">:</span> <span class="n">n_iterations</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>We are now prepared to run a fully-managed Hybrid Job to keep track of our experiments and scale up to larger models.</p>
</section>
<section id="creating-a-braket-job">
<h2>Creating a Braket Job<a class="headerlink" href="#creating-a-braket-job" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">AwsQuantumJob.create()</span></code> function requires a few arguments.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">device</span></code>:  Specifies the device we wish to run on. In this tutorial, we will use the Amazon Braket SV1 simulator. SV1 uses the full state-vector and supports up to 34 qubits.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source_module</span></code>: The directory or single file containing the code to run. This tutorial uses a directory qcbm that contains the script <code class="docutils literal notranslate"><span class="pre">qcbm_job.py</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">entry_point</span></code>: is the main script or function the job will run. This tutorial uses the function main() within <code class="docutils literal notranslate"><span class="pre">qcbm_job.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">job_name</span></code> (optional): A unique string to identify the job. We use the prefix <code class="docutils literal notranslate"><span class="pre">f&quot;qcbm-gaussian-training-{n_qubits}-{n_layers}&quot;</span></code>. We also append a time stamp to give the job a unique name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hyperparameters</span></code> (optional): The Python dictionary containing the hyperparameter names and values (as strings).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input_data</span></code> (optional): The path to Amazon S3 where our data was uploaded, or a local path that will be automatically upload data to S3.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wait_until_complete</span></code> (optional) : Optionally, we monitor the job inline (note this will prevent using the Jupyter notebook while the job is running). Set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to do an async job. Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a Amazon Braket Hybrid Job</span>

<span class="kn">import</span> <span class="nn">time</span> 
<span class="kn">from</span> <span class="nn">braket.aws</span> <span class="kn">import</span> <span class="n">AwsQuantumJob</span>

<span class="n">job_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;qcbm-gaussian-training-</span><span class="si">{</span><span class="n">n_qubits</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">n_layers</span><span class="si">}</span><span class="s2">-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>

<span class="n">job</span> <span class="o">=</span> <span class="n">AwsQuantumJob</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;arn:aws:braket:::device/quantum-simulator/amazon/sv1&quot;</span><span class="p">,</span>
    <span class="n">source_module</span><span class="o">=</span><span class="s2">&quot;qcbm&quot;</span><span class="p">,</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="s2">&quot;qcbm.qcbm_job:main&quot;</span><span class="p">,</span>
    <span class="n">job_name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="n">hyperparams</span><span class="p">,</span>
    <span class="n">input_data</span><span class="o">=</span><span class="s2">&quot;data.npy&quot;</span><span class="p">,</span> <span class="c1"># or input_data=s3_path</span>
    <span class="c1"># wait_until_complete=False,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Great! We created our first quantum machine learning job!</p>
<p>Since we set <code class="docutils literal notranslate"><span class="pre">wait_until_complete=False</span></code>, the job will run asynchronously and silently. We can check the status of the job with</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">state</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;QUEUED&#39;
</pre></div>
</div>
</div>
</div>
<p>We can also monitor the status of the job with the AWS Console.</p>
<div align="center"><img src="console_figures/running_job.png"/></div><p>Once it’s complete, we can grab the result with <code class="docutils literal notranslate"><span class="pre">job.result()</span></code> which will wait for the job to finish. In <code class="docutils literal notranslate"><span class="pre">qcbm_job.py</span></code>, we set the results to be the final parameters of the QCBM that minimized the loss function. Results are returned as a dictionary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span> 
<span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="c1"># should take 17 min with SV1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 666 ms, sys: 133 ms, total: 799 ms
Wall time: 17min 12s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;params&#39;: [0.318286378384603,
  0.8066883422428826,
  0.9965059377813476,
  0.3896290997335934,
  0.5206564140072295,
  -0.2764708825453678,
  -0.31186280728130517,
  1.0301286608615072,
  0.9152848732773509,
  0.5028883778151009,
  -0.08787270522674204,
  0.7817302047193129,
  0.9277263943430585,
  0.013617062714961346,
  0.33473964459716515,
  0.5093557157601054,
  -0.10513831465073813,
  0.7394344226370994,
  0.7317135947685797,
  0.22689351139220243,
  0.6120112028390869,
  0.12146385313274964,
  1.0822225752513248,
  -0.03458224708388502,
  -0.1581787215562068,
  0.6144033545499605,
  -0.03156199169778191,
  0.9605311859582252,
  0.29158765472875725,
  0.4800667308210175,
  0.5278158981111709,
  0.2207241644995396,
  -0.018214728388751607,
  1.0549851014368496,
  0.454472915580011,
  0.6728275933353882,
  0.5217854000399934,
  0.39243334991421674,
  0.9821097084351791,
  0.5170651734719544,
  0.7873812585011286,
  0.8900537481277946,
  0.21275468530086444,
  0.9275566358136947,
  0.39455123195247166]}
</pre></div>
</div>
</div>
</div>
<p>Awesome! Our first quantum machine learning job finished! Now let’s look at the training metrics.</p>
</section>
<section id="metrics-and-plotting">
<h2>Metrics and plotting<a class="headerlink" href="#metrics-and-plotting" title="Permalink to this heading">#</a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">qcbm_job.py</span></code> script, we monitored the loss function during training with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">log_metric</span><span class="p">(</span>
    <span class="n">metric_name</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
    <span class="n">iteration_number</span><span class="o">=</span><span class="n">iteration_number</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Metrics recorded in this way are visible from the “Monitor” tab in the AWS Console. It will look similar to the below image:</p>
<div align="center"><img src="console_figures/metrics.png"/></div>
<p>Metrics are also available by calling <code class="docutils literal notranslate"><span class="pre">job.metrics()</span></code>. Using pandas, and matplotlib, we plot the convergence of the loss below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting the convergence of the loss function metric</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">metrics</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">metrics</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;iteration_number&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;iteration_number&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;iteration_number&#39;&gt;
</pre></div>
</div>
<img alt="../../../_images/399990b20d1205944d17b8644330266c6d19e58c50df5a0132ca7d7981f6893e.png" src="../../../_images/399990b20d1205944d17b8644330266c6d19e58c50df5a0132ca7d7981f6893e.png" />
</div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">qcbm_job.py</span></code>, we called <code class="docutils literal notranslate"><span class="pre">save_job_result({&quot;params&quot;:</span> <span class="pre">params.tolist()})</span> </code> to save the optimal parameters that minimized the loss function.
Importantly, we can plot the predicted probability distribution vs the target probability from the data. To do so, we first import the QCBM locally again, but now we initialize it with the parameters returned from our job.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting the original probability distribution, and the QCBM prediction probability</span>
<span class="kn">from</span> <span class="nn">braket.devices</span> <span class="kn">import</span> <span class="n">LocalSimulator</span>
<span class="kn">from</span> <span class="nn">qcbm.qcbm</span> <span class="kn">import</span> <span class="n">QCBM</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">LocalSimulator</span><span class="p">()</span>
<span class="n">qcbm</span> <span class="o">=</span> <span class="n">QCBM</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">n_qubits</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="n">qcbm_probs</span> <span class="o">=</span> <span class="n">qcbm</span><span class="o">.</span><span class="n">probabilities</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="s2">&quot;params&quot;</span><span class="p">]))</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;{0:</span><span class="si">{fill}</span><span class="s2">6b}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">n_qubits</span><span class="p">),</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;target probability&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">n_qubits</span><span class="p">),</span> <span class="n">qcbm_probs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;QCBM probability&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))],</span> <span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Sample&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/ce27e843f59b341108d90ead917aa6bfd192fa3562a4cdc416d48459219b2f46.png" src="../../../_images/ce27e843f59b341108d90ead917aa6bfd192fa3562a4cdc416d48459219b2f46.png" />
</div>
</div>
<p>Great! As expected, the QCBM probability distribution closes matches the target distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Task Summary&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="s1">&#39;task summary&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated cost to run tasks in this job: </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="s1">&#39;estimated cost&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> USD&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Task Summary
{&#39;arn:aws:braket:::device/quantum-simulator/amazon/sv1&#39;: {&#39;shots&#39;: 11140000, &#39;tasks&#39;: {&#39;COMPLETED&#39;: 1114}, &#39;execution_duration&#39;: 36.416, &#39;billed_execution_duration&#39;: 3342.0}}
Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).
Estimated cost to run tasks in this job: 4.1775 USD
</pre></div>
</div>
</div>
</div>
</section>
<section id="running-different-hyperparameters">
<h2>Running different hyperparameters<a class="headerlink" href="#running-different-hyperparameters" title="Permalink to this heading">#</a></h2>
<p>One of the strengths of Braket Jobs is the ability to submit and monitor many jobs simultaneously. We can use this to perform a grid search to find good hyperparameters. Below we initialize 4 unique jobs with different <code class="docutils literal notranslate"><span class="pre">n_layers</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">n_layers</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating job with </span><span class="si">{</span><span class="n">n_layers</span><span class="si">}</span><span class="s2"> layers&quot;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;hyper-param-job-</span><span class="si">{</span><span class="n">n_qubits</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">n_layers</span><span class="si">}</span><span class="s2">-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
    <span class="n">hyperparams</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;n_qubits&quot;</span><span class="p">:</span> <span class="n">n_qubits</span><span class="p">,</span> 
        <span class="s2">&quot;n_layers&quot;</span><span class="p">:</span> <span class="n">n_layers</span><span class="p">,</span>
        <span class="s2">&quot;n_iterations&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>  
        <span class="s2">&quot;local&quot;</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span>
    <span class="p">}</span>

    <span class="n">tmp_job</span> <span class="o">=</span> <span class="n">AwsQuantumJob</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">device</span><span class="o">=</span><span class="s2">&quot;arn:aws:braket:::device/quantum-simulator/amazon/sv1&quot;</span><span class="p">,</span>
        <span class="n">source_module</span><span class="o">=</span><span class="s2">&quot;qcbm&quot;</span><span class="p">,</span>
        <span class="n">entry_point</span><span class="o">=</span><span class="s2">&quot;qcbm.qcbm_job:main&quot;</span><span class="p">,</span>
        <span class="n">job_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">hyperparameters</span><span class="o">=</span><span class="n">hyperparams</span><span class="p">,</span>
        <span class="n">input_data</span><span class="o">=</span><span class="s2">&quot;data.npy&quot;</span><span class="p">,</span>
        <span class="n">wait_until_complete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_job</span><span class="p">)</span>
    <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Creating job with 1 layers
Creating job with 2 layers
Creating job with 3 layers
Creating job with 4 layers
</pre></div>
</div>
</div>
</div>
<p>To check the results, we could load the results as we did before, or we could check the “Monitor” tab in the Braket Jobs dashboard in the AWS Console.</p>
<div align="center"><img src="console_figures/hp_job_console.png"/></div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span> 
<span class="c1"># this cell should take 20 min</span>
<span class="n">jobs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">result</span><span class="p">();</span> <span class="c1"># wait for the last job to finish</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 655 ms, sys: 55.4 ms, total: 711 ms
Wall time: 20min 13s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;params&#39;: [0.10582521466656217,
  0.6586736197367999,
  1.200696637224605,
  0.4795713744652507,
  0.0328225561013912,
  0.1416309729268562,
  -0.5345646198096557,
  1.0538623482363394,
  0.7051532697159473,
  1.1289212962111743,
  0.3252133525383767,
  1.35930000770726,
  0.6822907707251727,
  0.12822412303073896,
  0.05970880743338971,
  -0.12872775118257376,
  -0.01491068861101457,
  0.32288291810762443,
  0.718775541054627,
  0.5784806341360708,
  0.7367894357120217,
  0.11594024932187227,
  0.733472297708508,
  -0.026719234290999323,
  0.7264773526906863,
  0.7325621363172037,
  -0.046684249654940044,
  0.39342685130747507,
  0.5008300653892479,
  -0.029208732236774993,
  0.3555730806594967,
  0.3701310167636944,
  -0.11995921589574741,
  1.5015116657129093,
  1.4200581102942063,
  1.3390578795535855,
  -0.05630286546508683,
  0.5891673890248028,
  0.23324096170351397,
  -0.09559073124226201,
  0.3409907544669093,
  0.0033502886823119516,
  0.06831464166264858,
  0.8591375203801005,
  -0.2697950332966393,
  0.8423356850471669,
  0.1858015855270195,
  0.6236186948061898,
  0.9116432741463357,
  0.1584495053262102,
  1.3232439169325707,
  0.9815652537719447,
  1.238690541521269,
  1.6990444551463215,
  0.06688018372366623,
  0.8995581694378754,
  -0.13698545689704805,
  0.16493418873276403,
  -0.018569958408711576,
  0.29974234715189707]}
</pre></div>
</div>
</div>
</div>
<p>We can also load the jobs directly from their job arns.</p>
<p>We can now plot the results from all the hyperparameters experiments once they finish. If the cell below does not work, wait a few minutes for metrics to load and try again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jobs</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">metrics</span><span class="p">())</span>
    <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;iteration_number&quot;</span><span class="p">])</span>
    <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dfs</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;iteration_number&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_layers=</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;iteration_number&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/dfdf0de6c46b7634b317ece8cbd88aa2af35be8b09607e7d80ac5ccde0a52d60.png" src="../../../_images/dfdf0de6c46b7634b317ece8cbd88aa2af35be8b09607e7d80ac5ccde0a52d60.png" />
</div>
</div>
<p>For the plots above, we see that the loss is much lower for <code class="docutils literal notranslate"><span class="pre">n_layers=3</span></code> and <code class="docutils literal notranslate"><span class="pre">n_layers=4</span></code>. We can conclude for 5 qubits, we need at least 3 layers in the QCBM to accurately learn the two-peak Gaussian data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Task Summary&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="s1">&#39;task summary&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated cost to run tasks in this job: </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="s1">&#39;estimated cost&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> USD&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Task Summary
{&#39;arn:aws:braket:::device/quantum-simulator/amazon/sv1&#39;: {&#39;shots&#39;: 4550000, &#39;tasks&#39;: {&#39;COMPLETED&#39;: 455}, &#39;execution_duration&#39;: 16.96, &#39;billed_execution_duration&#39;: 1365.0}}
Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).
Estimated cost to run tasks in this job: 1.70625 USD
Task Summary
{&#39;arn:aws:braket:::device/quantum-simulator/amazon/sv1&#39;: {&#39;shots&#39;: 8780000, &#39;tasks&#39;: {&#39;COMPLETED&#39;: 878}, &#39;execution_duration&#39;: 33.115, &#39;billed_execution_duration&#39;: 2634.0}}
Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).
Estimated cost to run tasks in this job: 3.2925 USD
Task Summary
{&#39;arn:aws:braket:::device/quantum-simulator/amazon/sv1&#39;: {&#39;shots&#39;: 13890000, &#39;tasks&#39;: {&#39;COMPLETED&#39;: 1389}, &#39;execution_duration&#39;: 53.856, &#39;billed_execution_duration&#39;: 4167.0}}
Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).
Estimated cost to run tasks in this job: 5.20875 USD
Task Summary
{&#39;arn:aws:braket:::device/quantum-simulator/amazon/sv1&#39;: {&#39;shots&#39;: 14740000, &#39;tasks&#39;: {&#39;COMPLETED&#39;: 1474}, &#39;execution_duration&#39;: 57.8, &#39;billed_execution_duration&#39;: 4422.0}}
Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).
Estimated cost to run tasks in this job: 5.5275 USD
</pre></div>
</div>
</div>
</div>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">#</a></h2>
<p>In this notebook, we submitted a single training job in Amazon Braket Hybrid Jobs. We then simultaneously submitted 4 new jobs with different hyperparameters to learn about the number of layers required in our circuit.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<p>[1] Benedetti, Marcello, Delfina Garcia-Pintos, Oscar Perdomo, Vicente Leyton-Ortega, Yunseong Nam, and Alejandro Perdomo-Ortiz. “A Generative Modeling Approach for Benchmarking and Training Shallow Quantum Circuits.” Npj Quantum Information 5, no. 1 (May 27, 2019): 1–9. https://doi.org/10.1038/s41534-019-0157-8.</p>
<p>[2] Liu, Jin-Guo, and Lei Wang. “Differentiable Learning of Quantum Circuit Born Machine.” Physical Review A 98, no. 6 (December 19, 2018): 062324. https://doi.org/10.1103/PhysRevA.98.062324.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Quantum machine learning in Amazon Braket Hybrid Jobs</a><ul>
<li><a class="reference internal" href="#learning-outcomes">Learning outcomes</a></li>
<li><a class="reference internal" href="#background-generative-modelling">Background: Generative modelling</a></li>
<li><a class="reference internal" href="#quantum-circuit-born-machine">Quantum Circuit Born Machine</a></li>
<li><a class="reference internal" href="#problem-setup">Problem setup</a></li>
<li><a class="reference internal" href="#generate-data">Generate data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upload-data">Upload data</a><ul>
<li><a class="reference internal" href="#hyperparameters">Hyperparameters</a></li>
<li><a class="reference internal" href="#creating-a-braket-job">Creating a Braket Job</a></li>
<li><a class="reference internal" href="#metrics-and-plotting">Metrics and plotting</a></li>
<li><a class="reference internal" href="#running-different-hyperparameters">Running different hyperparameters</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    </body>
</html>