<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>QAOA with Amazon Braket Hybrid Jobs and PennyLane - Amazon Braket Examples documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">Amazon Braket Examples  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">Amazon Braket Examples  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  
</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="qaoa-with-amazon-braket-hybrid-jobs-and-pennylane">
<h1>QAOA with Amazon Braket Hybrid Jobs and PennyLane<a class="headerlink" href="#qaoa-with-amazon-braket-hybrid-jobs-and-pennylane" title="Permalink to this heading">#</a></h1>
<p>In this tutorial, we use PennyLane within Amazon Braket Hybrid Jobs to run the Quantum Approximate Optimization Algorithm (QAOA) on a Max-Cut problem.</p>
<section id="learning-outcomes">
<h2>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Use pre-built PennyLane containers in Braket Jobs</p></li>
<li><p>Set QAOA hyperparameters</p></li>
<li><p>Choose PennyLane backend (TensorFlow, PyTorch, Base)</p></li>
<li><p>Use checkpoints for Braket Jobs</p></li>
</ul>
</section>
<section id="qaoa-background">
<h2>QAOA background<a class="headerlink" href="#qaoa-background" title="Permalink to this heading">#</a></h2>
<p>QAOA is a variational algorithm that uses parameterized quantum circuits to evaluate a classical cost function given by a binary optimization problem; the circuit parameters are iteratively adjusted to minimize the cost function. The QAOA algorithm itself has different settings, such as circuit depth ($p$). In analogy to machine learning, these input settings are commonly referred to as <em>hyperparameters</em>. In the following, we show how to setup the problem, prepare input data and run QAOA using Braket Jobs.</p>
<p>For more information about QAOA and PennyLane, see <a class="reference internal" href="../../pennylane/2_Graph_optimization_with_QAOA/2_Graph_optimization_with_QAOA.html"><span class="doc std std-doc">this example notebook</span></a> or <a class="reference external" href="https://pennylane.ai/qml/demos/tutorial_qaoa_intro.html">this PennyLane tutorial</a>.</p>
</section>
<section id="problem-setup">
<h2>Problem setup<a class="headerlink" href="#problem-setup" title="Permalink to this heading">#</a></h2>
<p>A Max Cut problem is the problem to find a cut in a graph that maximizes the number of edges between the two parts after the cut. It has applications in theoretical physics and in combinatorial optimizations. To get started, we first create and visualize a random graph for the Max-Cut problem with <code>networkx</code> package. Feel free to adjust the number of nodes, <code>n</code>, and number of edges, <code>m</code> as part of your experiments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">braket.aws</span> <span class="kn">import</span> <span class="n">AwsQuantumJob</span><span class="p">,</span> <span class="n">AwsSession</span>
<span class="kn">from</span> <span class="nn">braket.jobs.image_uris</span> <span class="kn">import</span> <span class="n">Framework</span><span class="p">,</span> <span class="n">retrieve_image</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We generate a random graph with num_nodes nodes and num_edges edges to run Max Cut on.</span>
<span class="c1"># num_nodes is the number of nodes in your graph, each represented by one qubit. </span>
<span class="c1"># Caution: Circuit runtimes will scale exponentially with num_nodes</span>
<span class="n">num_nodes</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">num_edges</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">1967</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">gnm_random_graph</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">num_edges</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="c1"># Draw the graph</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2f7501abbf30c131400991dcdf0289437f6813410b15373f8ebf22e9a60fd4d6.png" src="../../../_images/2f7501abbf30c131400991dcdf0289437f6813410b15373f8ebf22e9a60fd4d6.png" />
</div>
</div>
</section>
<section id="prepare-input-data">
<h2>Prepare input data<a class="headerlink" href="#prepare-input-data" title="Permalink to this heading">#</a></h2>
<p>We will prepare the optimization problem we want to solve, represented by the so-called Ising matrix, as the input data for the Braket Job. This best practice helps us decouple our problem definition from our algorithm code. If we want to solve another instance of this problem type, all we need to do is to point a new job to the new input data. The input data can be specified by either a path to a local file, or an Amazon S3 path that points to the data. For this example, we will create a file in the local directory encoding the problem graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_file_path</span> <span class="o">=</span> <span class="s2">&quot;input-data.adjlist&quot;</span>
<span class="n">nx</span><span class="o">.</span><span class="n">write_adjlist</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">input_file_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="specify-hyperparameters-and-configurations">
<h2>Specify hyperparameters and configurations<a class="headerlink" href="#specify-hyperparameters-and-configurations" title="Permalink to this heading">#</a></h2>
<p>“The hyperparameters can be passed in when you create your job, through the keyword argument <code>hyperparameters</code>. It usually includes all the algorithm settings you might want to adjust between runs to tailor your algorithm to the problem. This includes, for instance, the optimizer to use and its learning rate, the number of iterations, or the number of shots per device execution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pick &#39;autograd&#39;, &#39;tf&#39;, or &#39;torch&#39;. Autograd is base PennyLane</span>
<span class="k">def</span> <span class="nf">define_hyperparameters</span><span class="p">(</span><span class="n">interface</span><span class="p">):</span>
    <span class="n">hyperparameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># Number of tasks per iteration = 2 * (num_nodes + num_edges) * p + 1</span>
        <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="n">seed</span><span class="p">,</span>
        <span class="c1"># Maximum number of simultaneous tasks allowed</span>
        <span class="s2">&quot;max_parallel&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="c1"># Number of total optimization iterations, including those from previous checkpoint (if any)</span>
        <span class="s2">&quot;num_iterations&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="c1"># Step size / learning rate for gradient descent</span>
        <span class="s2">&quot;stepsize&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="c1"># Shots for each circuit execution</span>
        <span class="s2">&quot;shots&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">&quot;interface&quot;</span><span class="p">:</span> <span class="n">interface</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">hyperparameters</span>
</pre></div>
</div>
</div>
</div>
<p>Braket Jobs comes with three pre-configured container environments: TensorFlow, PyTorch and Base.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">braket.aws</span> <span class="kn">import</span> <span class="n">AwsSession</span>

<span class="n">region</span> <span class="o">=</span> <span class="n">AwsSession</span><span class="p">()</span><span class="o">.</span><span class="n">region</span>

<span class="c1"># Choose the container based on which one we need.</span>
<span class="k">def</span> <span class="nf">select_container</span><span class="p">(</span><span class="n">interface</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">interface</span> <span class="o">==</span> <span class="s2">&quot;autograd&quot;</span><span class="p">:</span>
        <span class="n">image_uri</span> <span class="o">=</span> <span class="n">retrieve_image</span><span class="p">(</span><span class="n">Framework</span><span class="o">.</span><span class="n">BASE</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">interface</span> <span class="o">==</span> <span class="s2">&quot;tf&quot;</span><span class="p">:</span>
        <span class="n">image_uri</span> <span class="o">=</span> <span class="n">retrieve_image</span><span class="p">(</span><span class="n">Framework</span><span class="o">.</span><span class="n">PL_TENSORFLOW</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">interface</span> <span class="o">==</span> <span class="s2">&quot;torch&quot;</span><span class="p">:</span>
        <span class="n">image_uri</span> <span class="o">=</span> <span class="n">retrieve_image</span><span class="p">(</span><span class="n">Framework</span><span class="o">.</span><span class="n">PL_PYTORCH</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image_uri</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="algorithm-script">
<h2>Algorithm script<a class="headerlink" href="#algorithm-script" title="Permalink to this heading">#</a></h2>
<p>The algorithm script we are going to use for solving the Max-Cut problem with QAOA can be found <a class="reference download internal" download="" href="../../../_downloads/6f88185750252c2391728e2aa176d56f/qaoa_algorithm_script.py"><span class="xref download myst">here</span></a>.</p>
</section>
<section id="submitting-a-braket-job-base-container">
<h2>Submitting a Braket Job: Base Container<a class="headerlink" href="#submitting-a-braket-job-base-container" title="Permalink to this heading">#</a></h2>
<p>We have now finished preparing the input data, algorithm script, hyperparameters and other configurations. It’s time to submit our Braket Job!</p>
<p>We specify the following arguments to create our job:</p>
<ul class="simple">
<li><p><code>device</code>: The arn of the Braket simulator or QPU we want to use. It will be stored as an environment variable for the algorithm script.</p></li>
<li><p><code>source_module</code>: The path to a file or a python module that contains your algorithm script. It will be uploaded to the container for Braket Job execution.</p></li>
<li><p><code>job_name</code>: A unique string to identify the job. It appears in the Braket Job console and in the job arn.</p></li>
<li><p><code>image_uri</code>: The path to a Docker container image.</p></li>
<li><p><code>entry point</code>: The path relative to the source_module. It points to the piece of code to be executed when the Braket Job starts.</p></li>
<li><p><code>copy_checkpoints_from_job</code>: A string that specifies the job arn whose checkpoint you want to use in the current job. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (default value), no checkpoints will be copied to the current job.</p></li>
<li><p><code>hyperparameters</code>: The Python dictionary containing the hyperparameter names and values.</p></li>
<li><p><code>input_data</code>: A dictionary that maps channel names to either a file location in the local environment or a path to S3. We can also specify only a file location, in which case the channel name is treated as “input”.</p></li>
<li><p><code>wait_until_complete</code>: If True, the function call will wait until the Braket Job is completed, and will additionally print logs to the local console. Otherwise, it will run asynchronously. Defaults to False.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using autograd interface with Base container</span>
<span class="n">interface</span> <span class="o">=</span> <span class="s2">&quot;autograd&quot;</span>
<span class="n">hyperparameters</span> <span class="o">=</span> <span class="n">define_hyperparameters</span><span class="p">(</span><span class="n">interface</span><span class="p">)</span>

<span class="c1"># Specify device that the job will primarily be targeting</span>
<span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;arn:aws:braket:::device/quantum-simulator/amazon/sv1&quot;</span>

<span class="c1"># setting up the image_uri </span>
<span class="n">image_uri</span> <span class="o">=</span> <span class="n">select_container</span><span class="p">(</span><span class="n">interface</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span> <span class="o">=</span> <span class="n">AwsQuantumJob</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
    <span class="n">source_module</span><span class="o">=</span><span class="s2">&quot;qaoa&quot;</span><span class="p">,</span>
    <span class="c1"># Any unique name works. Note 50-character limit in job name</span>
    <span class="c1"># (comment out to use default naming)</span>
    <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;qaoa-job-&quot;</span> <span class="o">+</span> <span class="n">interface</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())),</span>
    <span class="n">image_uri</span><span class="o">=</span><span class="n">image_uri</span><span class="p">,</span>
    <span class="c1"># Relative to the source_module</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="s2">&quot;qaoa.qaoa_algorithm_script&quot;</span><span class="p">,</span>
    <span class="n">copy_checkpoints_from_job</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># general parameters</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="n">hyperparameters</span><span class="p">,</span>
    <span class="n">input_data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;input-graph&quot;</span><span class="p">:</span> <span class="n">input_file_path</span><span class="p">},</span>
    <span class="n">wait_until_complete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="view-results">
<h2>View results<a class="headerlink" href="#view-results" title="Permalink to this heading">#</a></h2>
<p>After the job is completed, we can view the result and the metric we defined in the algorithm script.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># This cell should take 7-8  minutes</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;params&#39;: [[-0.2213488042362593, -0.34576879319477966], [-0.07285138802088253, -0.17771989905871677]], &#39;cost&#39;: -2.612}
CPU times: user 254 ms, sys: 14.4 ms, total: 268 ms
Wall time: 6min
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># May need to wait a bit before metrics show up</span>
<span class="c1"># If metrics aren&#39;t there, run a bit later</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">metrics</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;timestamp&#39;: [1652488190.9026933, 1652488142.3026094], &#39;Cost&#39;: [-4.045, -4.038], &#39;iteration_number&#39;: [2.0, 0.0]}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A demonstration of plotting the metrics</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MaxNLocator</span>

<span class="n">metrics_data</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">metrics</span><span class="p">()</span>

<span class="k">if</span> <span class="n">metrics_data</span><span class="p">:</span> 
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">metrics</span><span class="p">())</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">figure</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;iteration_number&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Cost&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wait for metrics to populate and re-run the cell.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/5e4e910f6de8276996412f7c5d9f4ae20f03a317cb3622b7ca29210d9d6cfbb2.png" src="../../../_images/5e4e910f6de8276996412f7c5d9f4ae20f03a317cb3622b7ca29210d9d6cfbb2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Task Summary&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="s1">&#39;task summary&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated cost to run tasks in this job: </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="s1">&#39;estimated cost&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> USD&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Task Summary
{&#39;arn:aws:braket:::device/quantum-simulator/amazon/sv1&#39;: {&#39;shots&#39;: 286000, &#39;tasks&#39;: {&#39;COMPLETED&#39;: 286}, &#39;execution_duration&#39;: 7.078, &#39;billed_execution_duration&#39;: 858.0}}
Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).
Estimated cost to run tasks in this job: 1.0725 USD
</pre></div>
</div>
</div>
</div>
</section>
<section id="submitting-a-job-tensorflow-container">
<h2>Submitting a job: Tensorflow Container<a class="headerlink" href="#submitting-a-job-tensorflow-container" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using tensorflow interface with Tensorflow container</span>
<span class="n">interface</span> <span class="o">=</span> <span class="s2">&quot;tf&quot;</span>
<span class="n">hyperparameters</span> <span class="o">=</span> <span class="n">define_hyperparameters</span><span class="p">(</span><span class="n">interface</span><span class="p">)</span>

<span class="c1"># Specify device that the job will primarily be targeting</span>
<span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;arn:aws:braket:::device/quantum-simulator/amazon/sv1&quot;</span>

<span class="c1"># setting up the image_uri </span>
<span class="n">image_uri</span> <span class="o">=</span> <span class="n">select_container</span><span class="p">(</span><span class="n">interface</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span> <span class="o">=</span> <span class="n">AwsQuantumJob</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
    <span class="n">source_module</span><span class="o">=</span><span class="s2">&quot;qaoa&quot;</span><span class="p">,</span>
    <span class="c1"># Any unique name works. Note 50-character limit in job name</span>
    <span class="c1"># (comment out to use default naming)</span>
    <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;qaoa-job-&quot;</span> <span class="o">+</span> <span class="n">interface</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())),</span>
    <span class="n">image_uri</span><span class="o">=</span><span class="n">image_uri</span><span class="p">,</span>
    <span class="c1"># Relative to the source_module</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="s2">&quot;qaoa.qaoa_algorithm_script&quot;</span><span class="p">,</span>
    <span class="n">copy_checkpoints_from_job</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># general parameters</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="n">hyperparameters</span><span class="p">,</span>
    <span class="n">input_data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;input-graph&quot;</span><span class="p">:</span> <span class="n">input_file_path</span><span class="p">},</span>
    <span class="n">wait_until_complete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h2>View results<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<p>After the job is completed, we can view the result and the metric we defined in the algorithm script.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># This cell should take 8-9  minutes</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;params&#39;: [[0.09565119708100346, -0.0701687943257777], [-0.2417513917193508, -0.18191990185268442]], &#39;cost&#39;: -4.142}
CPU times: user 405 ms, sys: 26.7 ms, total: 432 ms
Wall time: 9min 46s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># May need to wait a bit before metrics show up</span>
<span class="c1"># If metrics aren&#39;t there, run a bit later</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">metrics</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;timestamp&#39;: [1652488812.506036, 1652488788.0409968, 1652488761.6457057], &#39;Cost&#39;: [-3.955, -4.015, -4.054], &#39;iteration_number&#39;: [2.0, 1.0, 0.0]}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A demonstration of plotting the metrics</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MaxNLocator</span>

<span class="n">metrics_data</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">metrics</span><span class="p">()</span>

<span class="k">if</span> <span class="n">metrics_data</span><span class="p">:</span> 
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">metrics</span><span class="p">())</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">figure</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;iteration_number&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Cost&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wait for metrics to populate and re-run the cell.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/19e5c0c58c0f51d5cc58fc2a5b74df0e92e3150ef43d25645e22cfb634790ca5.png" src="../../../_images/19e5c0c58c0f51d5cc58fc2a5b74df0e92e3150ef43d25645e22cfb634790ca5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Task Summary&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="s1">&#39;task summary&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated cost to run tasks in this job: </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="s1">&#39;estimated cost&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> USD&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Task Summary
{&#39;arn:aws:braket:::device/quantum-simulator/amazon/sv1&#39;: {&#39;shots&#39;: 286000, &#39;tasks&#39;: {&#39;COMPLETED&#39;: 286}, &#39;execution_duration&#39;: 9.721, &#39;billed_execution_duration&#39;: 858.0}}
Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).
Estimated cost to run tasks in this job: 1.0725 USD
</pre></div>
</div>
</div>
</div>
</section>
<section id="checkpoints">
<h2>Checkpoints<a class="headerlink" href="#checkpoints" title="Permalink to this heading">#</a></h2>
<p>It is best practice to regularly save interim progress of your job as checkpoints. If your job terminates unexpectedly, for instance, if a QPU becomes unavailable, you can create a new job and load its training progress from a <em>checkpoint</em>. To save checkpoints, the algorithm script should contain code like the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo &quot;Code in the algorithm script for saving a checkpoint&quot;

for iteration in range(start_iteration, num_iterations):
    # Training code omitted ...
    # ...
    save_job_checkpoint(
        checkpoint_data={
            &quot;iteration&quot;: iteration + 1,
            &quot;params&quot;: np_params.tolist(),
            &quot;cost_before&quot;: cost_before,
        },
        checkpoint_file_suffix=&quot;checkpoint-1&quot;,
    )
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Code in the algorithm script for saving a checkpoint
</pre></div>
</div>
</div>
</div>
<p>This code creates and overwrites a checkpoint file <code class="docutils literal notranslate"><span class="pre">&lt;jobname&gt;-checkpoint-1.json</span></code> in your Job artifacts under a subfolder checkpoints. To load from a checkpoint at the start of a new job, the algorithm script should contain code like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo &quot;Code in the algorithm script for loading a checkpoint&quot;

if &quot;copy_checkpoints_from_job&quot; in hyperparams:
    copy_checkpoints_from_job = hyperparams[&quot;copy_checkpoints_from_job&quot;].split(&quot;/&quot;, 2)[-1]

if copy_checkpoints_from_job:
    checkpoint_1 = load_job_checkpoint(
        copy_checkpoints_from_job,
        checkpoint_file_suffix=&quot;checkpoint-1&quot;,
    )
    start_iteration = checkpoint_1[&quot;iteration&quot;]
    params = interface.initialize_params(np.array(checkpoint_1[&quot;params&quot;]))
    print(&quot;Checkpoint loaded&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Code in the algorithm script for loading a checkpoint
</pre></div>
</div>
</div>
</div>
<p>This starts off the algorithm from the iteration and the parameters specified in the checkpoint file.</p>
<p>Let us see loading a checkpoint in action. We create a new job using the checkpoint from our existing job, this time training for another 2 iterations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_hyperparameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">hyperparameters</span><span class="p">)</span>
<span class="c1"># Increase number of iterations by 2</span>
<span class="n">new_hyperparameters</span><span class="p">[</span><span class="s2">&quot;num_iterations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hyperparameters</span><span class="p">[</span><span class="s2">&quot;num_iterations&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span>
<span class="c1"># Also add previous job arn in new hyperparameters</span>
<span class="n">new_hyperparameters</span><span class="p">[</span><span class="s2">&quot;copy_checkpoints_from_job&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">arn</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">continued_job</span> <span class="o">=</span> <span class="n">AwsQuantumJob</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
    <span class="n">source_module</span><span class="o">=</span><span class="s2">&quot;qaoa&quot;</span><span class="p">,</span>
    <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;qaoa-job-continued-&quot;</span> <span class="o">+</span> <span class="n">interface</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())),</span>
    <span class="n">image_uri</span><span class="o">=</span><span class="n">image_uri</span><span class="p">,</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="s2">&quot;qaoa.qaoa_algorithm_script&quot;</span><span class="p">,</span>
    <span class="c1"># We specify the previous job arn to copy checkpoints from</span>
    <span class="n">copy_checkpoints_from_job</span><span class="o">=</span><span class="n">job</span><span class="o">.</span><span class="n">arn</span><span class="p">,</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="n">new_hyperparameters</span><span class="p">,</span>
    <span class="n">input_data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;input-graph&quot;</span><span class="p">:</span> <span class="n">input_file_path</span><span class="p">},</span>
    <span class="n">wait_until_complete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> 
<span class="c1"># This cell should take 8-9 min</span>
<span class="n">continued_job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 7 µs, sys: 0 ns, total: 7 µs
Wall time: 12.4 µs
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;params&#39;: [[0.5304512035600284, 0.20428120976384603],
  [-0.31945139287717106, -0.22541990250088492]],
 &#39;cost&#39;: -4.9639999999999995}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># May need to wait a bit before metrics show up</span>
<span class="c1"># If metrics aren&#39;t there, run a bit later</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">continued_job</span><span class="o">.</span><span class="n">metrics</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;timestamp&#39;: [1652489391.446638, 1652489388.6802447, 1652489363.5430026], &#39;Cost&#39;: [-4.9639999999999995, -5.303, -4.203], &#39;iteration_number&#39;: [7.0, 6.0, 5.0]}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metrics_data</span> <span class="o">=</span> <span class="n">continued_job</span><span class="o">.</span><span class="n">metrics</span><span class="p">()</span>

<span class="k">if</span> <span class="n">metrics_data</span><span class="p">:</span> 
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">continued_job</span><span class="o">.</span><span class="n">metrics</span><span class="p">())</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">figure</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;iteration_number&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Cost&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wait for metrics to populate and re-run the cell.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/e5a4010e0bf90b755bc1f21f8fd39a7084c66e8c5e9c3f560cf9006500e853a8.png" src="../../../_images/e5a4010e0bf90b755bc1f21f8fd39a7084c66e8c5e9c3f560cf9006500e853a8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Task Summary&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">continued_job</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="s1">&#39;task summary&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated cost to run tasks in this job: </span><span class="si">{</span><span class="n">continued_job</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="s1">&#39;estimated cost&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> USD&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Task Summary
{&#39;arn:aws:braket:::device/quantum-simulator/amazon/sv1&#39;: {&#39;shots&#39;: 115000, &#39;tasks&#39;: {&#39;COMPLETED&#39;: 115}, &#39;execution_duration&#39;: 4.814, &#39;billed_execution_duration&#39;: 345.0}}
Note: Charges shown are estimates based on your Amazon Braket simulator and quantum processing unit (QPU) task usage. Estimated charges shown may differ from your actual charges. Estimated charges do not factor in any discounts or credits, and you may experience additional charges based on your use of other services such as Amazon Elastic Compute Cloud (Amazon EC2).
Estimated cost to run tasks in this job: 0.43125 USD
</pre></div>
</div>
</div>
</div>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<p>In this tutorial, we set up a Max-Cut problem with a random graph using PennyLane. We saved the graph to a local file and provided it as input data to our Braket Job, and used the pre-built PennyLane container image to run it. Variables that are required for the training process and the optimizer are passed as hyperparameters. The result is retrieved after the QAOA algorithm is completed. Lastly, we demonstrated how to use checkpoints to save and load training progress of a job.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">QAOA with Amazon Braket Hybrid Jobs and PennyLane</a><ul>
<li><a class="reference internal" href="#learning-outcomes">Learning outcomes</a></li>
<li><a class="reference internal" href="#qaoa-background">QAOA background</a></li>
<li><a class="reference internal" href="#problem-setup">Problem setup</a></li>
<li><a class="reference internal" href="#prepare-input-data">Prepare input data</a></li>
<li><a class="reference internal" href="#specify-hyperparameters-and-configurations">Specify hyperparameters and configurations</a></li>
<li><a class="reference internal" href="#algorithm-script">Algorithm script</a></li>
<li><a class="reference internal" href="#submitting-a-braket-job-base-container">Submitting a Braket Job: Base Container</a></li>
<li><a class="reference internal" href="#view-results">View results</a></li>
<li><a class="reference internal" href="#submitting-a-job-tensorflow-container">Submitting a job: Tensorflow Container</a></li>
<li><a class="reference internal" href="#id1">View results</a></li>
<li><a class="reference internal" href="#checkpoints">Checkpoints</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    </body>
</html>